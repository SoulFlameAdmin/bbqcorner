<!DOCTYPE html>
<html lang="bg">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Corner BBQ ‚Äî –ü—Ä–æ–º–æ—Ü–∏–∏</title>
<link rel="icon" type="image/png" href="/bbqsaitlogo.jpg">
<link rel="apple-touch-icon" href="/bbqsaitlogo.jpg">
<meta name="theme-color" content="#ff7a00" />
<style>
  :root{ --bg:#0e0f10; --panel:#15161a; --soft:#ffffff14; --text:#fff; --muted:#a5adb7; --accent:#ff7a00;
         --radius:18px; --border:#ffffff22; }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}

  header{position:sticky;top:0;z-index:30;display:flex;align-items:center;justify-content:space-between;
         padding:14px 16px;background:linear-gradient(180deg,#0009,transparent);backdrop-filter:blur(6px)}
  .title{font-weight:900;letter-spacing:.3px;color:#ff7a00}
  .btn{border:1px solid var(--border);background:#ffffff14;color:#fff;border-radius:12px;padding:8px 12px;cursor:pointer}
  /* NEW: —Å—Ç–∏–ª –∑–∞ –≤–∫–ª—é—á–µ–Ω Admin */
  .btn.on{ background:#ff7a00; border-color:#ff7a00; color:#111; font-weight:900; }

  .wrap{max-width:1300px;margin:0 auto;padding:16px}

  /* –ø—É–±–ª–∏—á–Ω–∏ –∫–∞—Ä—Ç–∏ */
  .promo-grid{display:grid;grid-template-columns:1fr;gap:16px}
  @media(min-width:900px){ .promo-grid{grid-template-columns:1fr 1fr} }
  .promo-card{
    position:relative;display:grid;grid-template-columns:1fr 1fr;min-height:260px;gap:0;
    background:linear-gradient(180deg,#111,#0c0d10);border:1px solid #ffffff18;border-radius:var(--radius);overflow:hidden;
    box-shadow:0 16px 50px rgba(0,0,0,.35)
  }
  .promo-img{position:relative}
  .promo-img img{width:100%;height:100%;object-fit:cover;display:block;filter:saturate(1.05) contrast(1.02)}
  .promo-overlay{position:absolute;inset:0;background:linear-gradient(180deg,transparent 30%, rgba(0,0,0,.55))}
  .promo-tag{position:absolute;top:10px;left:10px;background:#ffffff16;border:1px solid #ffffff2a;padding:6px 10px;border-radius:999px;font-size:12px;backdrop-filter:blur(4px)}
  .promo-info{position:absolute;left:10px;right:10px;bottom:10px;display:flex;flex-direction:column;gap:2px}
  .promo-name{font-weight:800;text-shadow:0 2px 14px #000}
  .promo-desc{font-size:12px;color:#e3e6ebcc;text-shadow:0 2px 8px #000}
  .promo-price{
    position:absolute;top:12px;right:12px;background:linear-gradient(180deg,#ff8a2a,#ff7a00);
    border:0;color:#111;font-weight:900;border-radius:14px;padding:10px 12px;box-shadow:0 10px 26px rgba(255,122,0,.45)
  }
.promo-plus{
  position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
  background:linear-gradient(180deg,#ff8a2a,#ff7a00);   /* –æ—Ä–∞–Ω–∂–µ–≤ */
  border:none;
  color:#111;                                           /* —Ç—ä–º–µ–Ω —Ç–µ–∫—Å—Ç */
  font-weight:900;border-radius:12px;padding:15px 20px;
  box-shadow:0 10px 26px rgba(0,0,0,.5);
  transition:background .2s,color .2s,transform .12s;
}
.promo-plus.clicked{
  background:#000;                                      /* —á–µ—Ä–µ–Ω –ø—Ä–∏ –∫–ª–∏–∫ */
  color:#fff;
}
.promo-plus:active{ transform:translate(-50%,-50%) scale(0.96); }

  /* X –∑–∞ –∏–∑—Ç—Ä–∏–≤–∞–Ω–µ (—Å–∞–º–æ –≤ Admin) */
  .promo-del{
    position:absolute;
    top:12px;
    left:12px;
    background:#ff7a00;
    color:#fff;
    border:none;
    border-radius:50%;
    width:28px;height:28px;
    font-size:18px;font-weight:bold;
    cursor:pointer;
    display:none;
    z-index:6;
    pointer-events:auto;
  }

  /* Builder */
  .builder{margin-top:18px;background:#13151a;border:1px solid var(--border);border-radius:var(--radius);padding:12px;display:none}
  .builder-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
  .rows{display:grid;gap:12px}
  .row{
    display:grid;
    grid-template-columns:1fr 54px 1fr 140px 38px;
    gap:12px;align-items:stretch
  }
  .drop{
    min-height:86px;border:2px dashed #ffffff2f;border-radius:14px;background:#0c0e12;padding:8px;display:flex;gap:8px;flex-wrap:wrap;align-content:flex-start
  }
  .chip{display:flex;gap:8px;align-items:center;background:#20232b;border:1px solid var(--border);border-radius:12px;padding:6px 8px}
  .chip img{width:36px;height:36px;border-radius:10px;object-fit:cover}
  .chip .meta{display:flex;flex-direction:column;line-height:1.05}
  .chip .nm{font-weight:700}
  .chip .ds{font-size:12px;color:#cbd3ddaa}
  .chip .x{cursor:pointer;opacity:.75;margin-left:4px}
  .pluscell{display:flex;align-items:center;justify-content:center;font-weight:900;opacity:.8}
  .price-input{width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:#0c0e12;color:#fff;font-weight:800}
  .row-del{display:flex;align-items:center;justify-content:center;border:1px solid var(--border);background:#2a1212;color:#fff;border-radius:12px;cursor:pointer;font-weight:900}
  .actions{display:flex;gap:10px;justify-content:flex-end;margin-top:10px}
  .hint{font-size:12px;color:#cbd3dd99}

  /* –¥–µ—Å–µ–Ω slide –∫–∞—Ç–∞–ª–æ–≥ */
  .slide{position:fixed;top:0;right:0;height:100dvh;width:360px;max-width:92vw;background:#14171d;border-left:1px solid var(--border);
         transform:translateX(100%);transition:transform .28s ease;z-index:40;display:flex;flex-direction:column}
  .slide.open{transform:translateX(0)}
  .slide-head{display:flex;align-items:center;gap:8px;justify-content:space-between;padding:12px;border-bottom:1px solid #ffffff1e}
  .slide-search{padding:10px 12px;border:1px solid var(--border);background:#0c0e12;color:#fff;border-radius:12px;margin:10px}
  .catalog{flex:1;overflow:auto;padding:10px;display:grid;gap:10px}

  /* –ø–ª–∏—Ç–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤–∏ –∫–∞—Ä—Ç–∏ (–≤—ä—Ç—Ä–µ –≤ slide) */
  .s-title{grid-column:1/-1;margin:6px 2px 8px;color:#cbd3dd99;font-weight:900;opacity:.85}
  .s-cat{display:flex;gap:10px;align-items:center;background:#0f1116;border:1px solid #ffffff1a;border-radius:14px;padding:10px;cursor:pointer;}
  .s-cat img{width:56px;height:56px;border-radius:12px;object-fit:cover;background:#0b0c10}
  .s-cat .meta{display:flex;flex-direction:column;gap:2px}
  .s-cat .nm{font-weight:900}
  .s-cat .ds{font-size:12px;color:#cbd3ddaa}

  .s-card{display:grid;grid-template-columns:70px 1fr auto;gap:8px;align-items:center;
    background:#0f1116;border:1px solid #ffffff1a;border-radius:14px;padding:8px;cursor:grab}
  .s-card img{width:70px;height:56px;object-fit:cover;border-radius:10px;background:#0b0c10}
  .s-card .nm{font-weight:800}
  .s-card .pr{font-weight:900}

  /* HELL gallery –≤—ä—Ç—Ä–µ –≤ slide */
  .s-gallery{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .s-tile{background:#0f1116;border:1px solid #ffffff1a;border-radius:14px;padding:8px;cursor:grab;text-align:center}
  .s-tile img{width:100%;height:150px;object-fit:contain;border-radius:10px;background:#0b0c10}
  .s-cap{margin-top:6px;font-size:12px;font-weight:800;opacity:.9}
  .s-price{font-weight:900;margin-top:6px}

  /* Water 2-–∫–æ–ª–æ–Ω–∏ */
  .s-water{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .s-water .s-wcard{background:#0f1116;border:1px solid #ffffff1a;border-radius:14px;padding:8px;text-align:center;cursor:grab}
  .s-water img{width:100%;height:150px;object-fit:contain;border-radius:10px;background:#0b0c10}
  .s-wname{margin-top:6px;font-weight:800}
  .s-wprice{font-weight:900;margin-top:6px}

  .toast{position:fixed;bottom:16px;right:16px;background:#111;border:1px solid var(--border);color:#fff;border-radius:12px;padding:10px 12px;display:none;z-index:50}
</style>
</head>
<body>
  <header>
    <div class="title">üî• Corner BBQ ‚Äî –ü—Ä–æ–º–æ—Ü–∏–∏</div>
    <div style="display:flex;gap:8px">
      <button id="adminBtn" class="btn">Admin</button>
      <!-- NEW: —Å–∫—Ä–∏—Ç –ø–æ –ø–æ–¥—Ä–∞–∑–±–∏—Ä–∞–Ω–µ -->
      <button id="catalogBtn" class="btn" title="–ö–∞—Ç–∞–ª–æ–≥" style="display:none">–ö–∞—Ç–∞–ª–æ–≥</button>
    </div>
  </header>

  <div class="wrap">
    <h2 style="margin:0 0 8px 0">–¢–µ–∫—É—â–∏ –ø—Ä–æ–º–æ—Ü–∏–∏</h2>
    <div class="promo-grid" id="promoGrid"></div>

    <!-- Builder -->
    <section id="builder" class="builder" aria-hidden="true">
      <div class="builder-head">
        <strong>–°—ä–∑–¥–∞–π –ø—Ä–æ–º–æ –ø–∞–∫–µ—Ç</strong>
        <span class="hint">–ü–æ–ª–µ A + –ü–æ–ª–µ B ‚Üí –Ω–∞–ø–∏—à–∏ —Ü–µ–Ω–∞ ‚Üí ‚Äû–ó–∞–ø–∞–∑–∏‚Äú.</span>
      </div>
      <div class="rows" id="rows"></div>
      <div class="actions">
        <button class="btn" id="addRow">+ –†–µ–¥</button>
        <button class="btn" id="save">–ó–∞–ø–∞–∑–∏</button>
      </div>
    </section>
  </div>

  <!-- –¥–µ—Å–µ–Ω slide-in –∫–∞—Ç–∞–ª–æ–≥ -->
  <aside id="slide" class="slide" aria-hidden="true">
    <div class="slide-head">
      <button class="btn" id="backBtn" title="–ù–∞–∑–∞–¥" style="display:none">‚Üê –ù–∞–∑–∞–¥</button>
      <strong id="slideTitle" style="margin-left:6px">–ö–∞—Ç–∞–ª–æ–≥ –ø—Ä–æ–¥—É–∫—Ç–∏</strong>
      <button class="btn" id="closeSlide">‚úï</button>
    </div>
    <input id="search" class="slide-search" placeholder="–¢—ä—Ä—Å–∏‚Ä¶ (–∏–º–µ/–æ–ø–∏—Å–∞–Ω–∏–µ)">
    <div id="catalog" class="catalog"></div>
  </aside>

  <div id="toast" class="toast"></div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

  <script>
/* ===================== Firebase ===================== */
const firebaseConfig = {
  apiKey: "AIzaSyAhaEPIEODEoRiwTulBw4W9YTXyMW9sqKg",
  authDomain: "corner-bbq.firebaseapp.com",
  databaseURL: "https://corner-bbq-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "corner-bbq",
  storageBucket: "corner-bbq.firebasestorage.app",
  messagingSenderId: "878314744141",
  appId: "1:878314744141:web:f869886ee4380e9dbcaf04",
  measurementId: "G-FWBDL96GN0"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* ===================== DOM refs ===================== */
const adminBtn   = document.getElementById('adminBtn');
const builder    = document.getElementById('builder');
const promoGrid  = document.getElementById('promoGrid');
const rowsWrap   = document.getElementById('rows');
const addRowBtn  = document.getElementById('addRow');
const saveBtn    = document.getElementById('save');

const slide      = document.getElementById('slide');
const catalogEl  = document.getElementById('catalog');
const searchEl   = document.getElementById('search');
const catalogBtn = document.getElementById('catalogBtn');
const closeSlide = document.getElementById('closeSlide');
const backBtn    = document.getElementById('backBtn');
const slideTitle = document.getElementById('slideTitle');

/* ===================== State ===================== */
const ADMIN_PASS = "bbqcornera123";
let isAdmin = false;
let catalog = []; // –æ—Ç Firebase /products (–∑–∞ —Ç—ä—Ä—Å–µ–Ω–µ –ø–æ –≤—Å–∏—á–∫–∏)
let rows = [];    // builder —Ä–µ–¥–æ–≤–µ [{A,B,price}]
let view = 'cats';               // cats | cat | all
let currentKey = null;           // –∫–ª—é—á –æ—Ç CATALOG (index2)

/* ===================== Admin UI helper ===================== */
function toggleDeleteButtons(forceShow=false){
  const show = forceShow || isAdmin;
  document.querySelectorAll('.promo-del').forEach(btn=>{
    btn.style.display = show ? 'block' : 'none';
  });
}
/* NEW: —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–∏—Ä–∞–Ω–æ –≤–∫–ª—é—á–≤–∞–Ω–µ/–∏–∑–∫–ª—é—á–≤–∞–Ω–µ –Ω–∞ Admin */
function setAdminUI(enabled){
  isAdmin = !!enabled;

  // –±—É—Ç–æ–Ω Admin ‚Äì –≤–∏–∑–∏—è –∏ —Ç–µ–∫—Å—Ç
  adminBtn.classList.toggle('on', enabled);
  adminBtn.textContent = enabled ? 'Admin (–≤–∫–ª—é—á–µ–Ω)' : 'Admin';

  // –ø–æ–∫–∞–∑–≤–∞–Ω–µ/—Å–∫—Ä–∏–≤–∞–Ω–µ –Ω–∞ –∞–¥–º–∏–Ω UI
  builder.style.display = enabled ? 'block' : 'none';
  if (!enabled) slide.classList.remove('open');

  // –ö–∞—Ç–∞–ª–æ–≥ ‚Äì –ø–æ–∫–∞–∑–≤–∞ —Å–µ —Å–∞–º–æ –≤ –∞–¥–º–∏–Ω —Ä–µ–∂–∏–º
  catalogBtn.style.display = enabled ? 'inline-block' : 'none';

  // X –∑–∞ —Ç—Ä–∏–µ–Ω–µ –≤ –∫–∞—Ä—Ç–∏—Ç–µ
  toggleDeleteButtons(enabled);
}

/* ==== –ê–≤—Ç–æ-Admin –≤ iframe: ?admin=1 –∏–ª–∏ #admin=1 + —Å–ª—É—à–∞–Ω–µ –∑–∞ postMessage ==== */
(() => {
  const hasFlag =
    new URLSearchParams(location.search).get('admin') === '1' ||
    /\badmin=1\b/.test(location.hash + location.href) ||
    /\badmin=1\b/.test(document.referrer || '');

  // –æ–ø–∏—Ç –æ—Ç —Ä–æ–¥–∏—Ç–µ–ª—è (same-origin)
  let parentSaysAdmin = false;
  try {
    parentSaysAdmin = /\badmin=1\b/.test(parent.location.search);
  } catch(_){}

  if (hasFlag || parentSaysAdmin) {
    setAdminUI(true);
    const mo = new MutationObserver(() => toggleDeleteButtons(true));
    mo.observe(document.getElementById('promoGrid'), { childList:true, subtree:true });
  }

  // —Ä–µ–∑–µ—Ä–≤–Ω–æ ‚Äì —Å–ª—É—à–∞–π postMessage
  window.addEventListener('message', (e) => {
    if (e?.data?.type === 'bbq-admin' && e.data.enabled) {
      setAdminUI(true);
    }
  });
})();

/* ===================== –ö–∞—Ç–µ–≥–æ—Ä–∏–∏/–º–∏–Ω–∏–∞—Ç—é—Ä–∏ –æ—Ç index2 (–ù–ï –ü–ò–ü–ê–ú–ï –ö–ê–¢–ê–õ–û–ì–ê) ===================== */
const CAT_ORDER = [
  'burgeri','palachinki','strandzhanki','kartofi','salati','portsii','dobavki',
  'hell','voda','gazirana_voda','fanta','studen_chai','kola','sok','xixo','airqn'
];
const CAT_TITLES = {
  burgeri:'–ë–£–†–ì–ï–†–ò', palachinki:'–ü–ê–õ–ê–ß–ò–ù–ö–ò', strandzhanki:'–°–¢–†–ê–ù–î–ñ–ê–ù–ö–ò',
  kartofi:'–ö–ê–†–¢–û–§–ò', salati:'–°–ê–õ–ê–¢–ò', portsii:'–ü–û–†–¶–ò–ò', dobavki:'–î–û–ë–ê–í–ö–ò',
  hell:'HELL', voda:'–í–û–î–ê', gazirana_voda:'–ì–ê–ó–ò–†–ê–ù–ê –í–û–î–ê', fanta:'–§–ê–ù–¢–ê',
  studen_chai:'–°–¢–£–î–ï–ù –ß–ê–ô', kola:'–ö–û–õ–ê', sok:'–°–û–ö', xixo:'XIXO', airqn:'–ê–ô–†–Ø–ù'
};
const TITLE_TO_KEY = Object.fromEntries(Object.entries(CAT_TITLES).map(([k,v])=>[v,k]));
const CAT_THUMBS = {
  burgeri:'snimki/produkti/1menu/burger.jpg',
  palachinki:'snimki/produkti/1menu/palachinki.jpg',
  strandzhanki:'snimki/produkti/1menu/strandjanka.jpg',
  kartofi:'snimki/produkti/1menu/kartofi.jpg',
  salati:'snimki/produkti/1menu/salata.jpg',
  portsii:'snimki/produkti/1menu/porciq.jpg',
  sosove:'snimki/produkti/1menu/sosove.jpg',
  dobavki:'snimki/produkti/1menu/dobavki.jpg',
  deserti:'snimki/produkti/1menu/desert.jpg',
  bezalkoholni:'snimki/produkti/1menu/bezalkoholno.jpg',
  bira:'snimki/produkti/1menu/bira.jpg',
  hell:'snimki/produkti/1menu/hell.jpg',
  voda:'snimki/produkti/–í–û–î–ê/voda_snimka.jpg',
  gazirana_voda:'snimki/produkti/–ì–ê–ó–ò–†–ê–ù–ê_–í–û–î–ê/gaziranavoda_snimka.jpg',
  fanta:'snimki/produkti/–§–ê–ù–¢–ê/fanta_logo.jpg',
  studen_chai:'snimki/produkti/–°–¢–£–î–ï–ù_–ß–ê–ô/studen_chai_logo.jpg',
  kola:'snimki/produkti/–ö–û–õ–ê/kola_logo.jpg',
  sok:'snimki/produkti/–°–û–ö/cappy_logo.jpg',
  airqn:'snimki/produkti/–ê–ô–†–ê–ù/vereq_logo.jpg',
  xixo:'snimki/produkti/–•–ò–•–û/xixo_logo.jpg'
};

/* ===================== CATALOG (–ù–ï –ü–ò–ü–ê–ú–ï –ö–ê–¢–ê–õ–û–ì–ê ‚Äì –û–°–¢–ê–í–ê –¢–û–ß–ù–û –ö–ê–ö–¢–û –ï) ===================== */
const CATALOG = {
  burgeri:{title:'–ë–£–†–ì–ï–†–ò',items:[
    {name:'–ö–û–ù–°–ö–ê –ü–õ–ï–°–ö–ê–í–ò–¶–ê',price:9.00,img:'snimki/produkti/2menu/konski.jpg'},
    {name:'–¢–ï–õ–ï–®–ö–ê –ü–õ–ï–°–ö–ê–í–ò–¶–ê',price:9.00,img:'snimki/produkti/2menu/sharska.jpg'},
    {name:'–®–ê–†–°–ö–ê –ü–õ–ï–°–ö–ê–í–ò–¶–ê',price:9.50,img:'snimki/produkti/2menu/sharska.jpg'},
    {name:'–°–í–ò–ù–°–ö–ê –í–ï–®–ê–õ–ò–¶–ê',price:9.00,img:'snimki/produkti/2menu/sharska.jpg'},
    {name:'–ü–ò–õ–ï–®–ö–ò –°–¢–ï–ö',price:9.00,img:'snimki/produkti/2menu/pileshkistek.jpg'},
    {name:'–í–ï–ì–ï–¢–ê–†–ò–Ø–ù–°–ö–ò',price:5.00,img:'snimki/produkti/2menu/vegan.jpg'},
    {name:'–î–í–û–ô–ù–ê –®–ê–†–°–ö–ê –ü–õ–ï–°–ö–ê–í–ò–¶–ê',price:12.50,img:'snimki/produkti/2menu/sharska.jpg'},
    {name:'–î–í–û–ô–ù–ê –ö–û–ù–°–ö–ê –ü–õ–ï–°–ö–ê–í–ò–¶–ê',price:12.00,img:'snimki/produkti/2menu/konski.jpg'},
    {name:'–î–í–û–ô–ù–ê –°–í–ò–ù–°–ö–ê –í–ï–®–ê–õ–ò–¶–ê',price:12.00,img:'snimki/produkti/2menu/sharska.jpg'},
    {name:'–î–í–û–ï–ù –ü–ò–õ–ï–®–ö–ò –°–¢–ï–ö',price:12.00,img:'snimki/produkti/2menu/pileshkistek.jpg'},
    {name:'–î–í–û–ô–ù–ê –¢–ï–õ–ï–®–ö–ê –ü–õ–ï–°–ö–ê–í–ò–¶–ê',price:12.00,img:'snimki/produkti/2menu/sharska.jpg'},
    {name:'–ë–£–†–ì–ï–† –° –î–™–†–ü–ê–ù–û –¢–ï–õ–ï–®–ö–û',price:12.50,img:'snimki/produkti/2menu/durpano.jpg'},
  ]},
  palachinki:{
    title:'–ü–ê–õ–ê–ß–ò–ù–ö–ò',
    groups:[
      { heading:'–°–õ–ê–î–ö–ò', items:[
        {name:'–ü–ê–õ–ê–ß–ò–ù–ö–ê –°–™–° NUCREMA –®–û–ö–û–õ–ê–î',price:5.00,img:'snimki/produkti/–ü–ê–õ–ê–ß–ò–ù–ö–ò/shokolad.jpg'},
        {name:'–ü–ê–õ–ê–ß–ò–ù–ö–ê –°–™–° NUCREMA –®–û–ö–û–õ–ê–î –ò –ë–ê–ù–ê–ù',price:6.00,img:'snimki/produkti/–ü–ê–õ–ê–ß–ò–ù–ö–ò/shokoladibanan.png'},
        {name:'–ü–ê–õ–ê–ß–ò–ù–ö–ê –° –ú–ï–î –ò –û–†–ï–•–ò',price:5.50,img:'snimki/produkti/–ü–ê–õ–ê–ß–ò–ù–ö–ò/mediorehi.png'},
        {name:'–ü–ê–õ–ê–ß–ò–ù–ö–ê –°–™–° –°–õ–ê–î–ö–û –û–¢ –ë–û–†–û–í–ò–ù–ö–ò',price:5.00,img:'snimki/produkti/–ü–ê–õ–ê–ß–ò–ù–ö–ò/borovinki.png'},
        {name:'–ü–ê–õ–ê–ß–ò–ù–ö–ê –°–™–° –°–õ–ê–î–ö–û –û–¢ –ü–†–ê–°–ö–û–í–ê',price:5.00,img:'snimki/produkti/–ü–ê–õ–ê–ß–ò–ù–ö–ò/praskovi.png'},
        {name:'–ü–ê–õ–ê–ß–ò–ù–ö–ê –°–™–° –°–õ–ê–î–ö–û –û–¢ –Ø–ì–û–î–ò',price:5.00,img:'snimki/produkti/–ü–ê–õ–ê–ß–ò–ù–ö–ò/qgodi.png'},
      ]},
      { heading:'–°–û–õ–ï–ù–ò', items:[
        {name:'–°–ò–†–ï–ù–ï –ò –°–õ–ê–î–ö–û',price:5.50,img:'snimki/produkti/–ü–ê–õ–ê–ß–ò–ù–ö–ò/sirene.png'},
        {name:'–ü–ê–õ–ê–ß–ò–ù–ö–ê –°–™–° –°–ò–†–ï–ù–ï',price:5.00,img:'snimki/produkti/–ü–ê–õ–ê–ß–ò–ù–ö–ò/sirene.png'},
        {name:'–ü–ê–õ–ê–ß–ò–ù–ö–ê –°–™–° –ö–ê–®–ö–ê–í–ê–õ',price:5.50,img:'snimki/produkti/–ü–ê–õ–ê–ß–ò–ù–ö–ò/kashkaval.png'},
        {name:'–ü–ê–õ–ê–ß–ò–ù–ö–ê –°–™–° –°–ò–†–ï–ù–ï –ò –ö–ê–®–ö–ê–í–ê–õ',price:6.00,img:'snimki/produkti/–ü–ê–õ–ê–ß–ò–ù–ö–ò/kashkavalisirene.png'},
        {name:'–ü–ê–õ–ê–ß–ò–ù–ö–ê –° –ú–ê–°–õ–û',price:4.50,img:'snimki/produkti/–ü–ê–õ–ê–ß–ò–ù–ö–ò/maslo.png'},
      ]}
    ]
  },
  strandzhanki:{ title:'–°–¢–†–ê–ù–î–ñ–ê–ù–ö–ò', items:[
    {name:'–¢–ï–õ–ï–®–ö–ê –°–¢–†–ê–ù–î–ñ–ê–ù–ö–ê',price:5.00,img:CAT_THUMBS.strandzhanki},
    {name:'–°–í–ò–ù–°–ö–ê –°–¢–†–ê–ù–î–ñ–ê–ù–ö–ê',price:5.00,img:CAT_THUMBS.strandzhanki},
  ]},
  kartofi:{ title:'–ö–ê–†–¢–û–§–ò', items:[
    {name:'–ü–™–†–ñ–ï–ù–ò –ö–ê–†–¢–û–§–ò 200 –ì–†–ê–ú–ê',price:4.00,img:'snimki/produkti/–ö–ê–†–¢–û–§–ò/kartofi.jpg'},
    {name:'–ö–ê–†–¢–û–§–ò –° –ß–ï–î–™–† –ò –ë–ï–ö–û–ù',price:6.50,img:'snimki/produkti/–ö–ê–†–¢–û–§–ò/kartofisbekonichedur.jpg'},
    {name:'–ö–ê–†–¢–û–§–ò –° –ß–ï–î–™–†',price:5.00,img:'snimki/produkti/–ö–ê–†–¢–û–§–ò/kartofischedur.jpg'},
  ]},
  salati:{ title:'–°–ê–õ–ê–¢–ò', items:[ {name:'–°–ê–õ–ê–¢–ê –¶–ï–ó–ê–†', price:8.50, img:CAT_THUMBS.salati} ]},
  portsii:{ title:'–ü–û–†–¶–ò–ò', items:[
    {name:'–†–ê–ó–Ø–î–ö–ê 100 –ì–†–ê–ú–ê',price:1.50,img:CAT_THUMBS.portsii},
    {name:'–ü–ò–¢–ö–ê 1 –ë–†–û–ô',price:1.50,img:'snimki/produkti/–ü–û–†–¶–ò–ò/pitka.jpg'},
    {name:'–¢–ï–õ–ï–®–ö–ê –ü–õ–ï–°–ö–ê–í–ò–¶–ê –ü–û–†–¶–ò–Ø',price:11.50,img:'snimki/produkti/–ü–û–†–¶–ò–ò/sharsko.jpg'},
    {name:'–ü–ò–õ–ï–®–ö–û –§–ò–õ–ï –ü–û–†–¶–ò–Ø',price:11.00,img:'snimki/produkti/–ü–û–†–¶–ò–ò/pileshko.jpg'},
    {name:'–°–í–ò–ù–°–ö–û –§–ò–õ–ï –ü–û–†–¶–ò–Ø',price:11.00,img:'snimki/produkti/–ü–û–†–¶–ò–ò/svinsko.jpg'},
    {name:'–¢–ï–õ–ï–®–ö–ò –ö–ï–ë–ê–ü–ß–ï–¢–ê –ü–û–†–¶–ò–Ø',price:9.50,img:'snimki/produkti/–ü–û–†–¶–ò–ò/kebapche.jpg'},
    {name:'–®–ê–†–°–ö–ê –ü–õ–ï–°–ö–ê–í–ò–¶–ê –ü–û–†–¶–ò–Ø',price:12.50,img:'snimki/produkti/–ü–û–†–¶–ò–ò/sharsko.jpg'},
  ]},
  dobavki:{ title:'–î–û–ë–ê–í–ö–ò', items:[
    {name:'–°–ò–†–ï–ù–ï 100 –ì–†–ê–ú–ê',price:1.50},
    {name:'–ö–ê–®–ö–ê–í–ê–õ 100 –ì–†–ê–ú–ê',price:1.50},
    {name:'–î–†–ï–°–ò–ù–ì –î–û–ë–ê–í–ö–ê',price:1.00},
    {name:'–ú–ï–°–û –î–û–ë–ê–í–ö–ê',price:4.00},
    {name:'–ü–ò–¢–ö–ê',price:1.50},
  ]},
  sosove:{ title:'–°–û–°–û–í–ï', items:[
    {name:'–î–û–ú–ê–®–ù–ê –†–ê–ó–Ø–î–ö–ê 100–ì–†', price:1.50, img:CAT_THUMBS.sosove},
    {name:'–î–û–ú–ê–®–ù–ê –ú–ê–ô–û–ù–ï–ó–ê',     price:1.50, img:CAT_THUMBS.sosove},
    {name:'–õ–Æ–¢–ï–ù–ò–¶–ê',             price:1.50, img:CAT_THUMBS.sosove},
    {name:'–ö–ï–¢–ß–£–ü',               price:1.00, img:CAT_THUMBS.sosove},
    {name:'–ì–û–†–ß–ò–¶–ê',              price:1.00, img:CAT_THUMBS.sosove},
    {name:'–°–û–° –¶–ï–ó–ê–†',            price:1.50, img:CAT_THUMBS.sosove},
  ]},
  deserti:{ title:'–î–ï–°–ï–†–¢–ò', items:[
    {name:'–õ–ï–ö –î–ï–°–ï–†–¢ –° –ß–ò–Ø, –ú–Æ–°–õ–ò –ò –°–£–®–ï–ù–ò –ü–õ–û–î–û–í–ï',price:4.50,img:CAT_THUMBS.deserti},
    {name:'–õ–ï–ö –î–ï–°–ï–†–¢ –° –ß–ò–Ø, –ú–Æ–°–õ–ò –ò –°–õ–ê–î–ö–û –û–¢ –ë–û–†–û–í–ò–ù–ö–ò',price:4.50,img:CAT_THUMBS.deserti},
  ]},
  bezalkoholni:{ title:'–ë–ï–ó–ê–õ–ö–û–•–û–õ–ù–ò', items:[
    {name:'–ö–û–õ–ê –ö–ï–ù',price:2.00,img:CAT_THUMBS.bezalkoholni},
    {name:'–§–ê–ù–¢–ê –ü–û–†–¢–û–ö–ê–õ –ö–ï–ù',price:2.00,img:CAT_THUMBS.bezalkoholni},
    {name:'–ö–û–ö–ê –ö–û–õ–ê –ë–£–¢–ò–õ–ö–ê',price:2.50,img:CAT_THUMBS.bezalkoholni},
    {name:'–§–ê–ù–¢–ê –ü–û–†–¢–û–ö–ê–õ –ë–£–¢–ò–õ–ö–ê',price:2.50,img:CAT_THUMBS.bezalkoholni},
    {name:'–°–ü–†–ê–ô–¢ –ë–£–¢–ò–õ–ö–ê',price:2.50,img:CAT_THUMBS.bezalkoholni},
    {name:'–°–¢–£–î–ï–ù –ß–ê–ô',price:2.50,img:CAT_THUMBS.bezalkoholni},
    {name:'–ö–ê–ü–ò –ü–™–õ–ü–ò',price:2.50,img:CAT_THUMBS.bezalk–æ—Ö–æ–ª–Ω–∏},
    {name:'–ö–ê–ü–ò –ö–£–¢–ò–Ø',price:1.70,img:CAT_THUMBS.bezalkoholni},
    {name:'–°–û–î–ê –ë–£–¢–ò–õ–ö–ê',price:1.90,img:CAT_THUMBS.bezalkoholni},
    {name:'–ú–ê–õ–ö–ê –ú–ò–ù–ï–†–ê–õ–ù–ê –í–û–î–ê',price:1.50,img:CAT_THUMBS.bezalkoholni},
    {name:'–ì–û–õ–Ø–ú–ê –ú–ò–ù–ï–†–ê–õ–ù–ê –í–û–î–ê',price:2.00,img:CAT_THUMBS.bezalkoholni},
    {name:'–ö–ê–ü–ò –õ–ò–ú–û–ù–ê–î–ê',price:2.50,img:CAT_THUMBS.bezalkoholni},
    {name:'–¢–û–ù–ò–ö –ë–£–¢–ò–õ–ö–ê',price:1.90,img:CAT_THUMBS.bezalkoholni},
  ]},
  bira:{ title:'–ë–ò–†–ê', items:[
    {name:'–ë–ò–†–ê –ö–û–†–û–ù–ê',price:3.50,img:CAT_THUMBS.bira},
    {name:'–•–ê–ô–ù–ò–ö–ï–ù',price:4.00,img:CAT_THUMBS.bira},
    {name:'–°–¢–ï–õ–ê –ê–†–¢–û–ê',price:4.50,img:CAT_THUMBS.bira},
  ]},
  hell:{
    title:'HELL', view:'gallery', hellPrice:2.00,
    groups:[
      { heading:'HELL', images:[
        'snimki/hell_sminki/normal/hell_apple.jpg',
        'snimki/hell_sminki/normal/hell_clasic.jpg',
        'snimki/hell_sminki/normal/hell_classic.jpg',
        'snimki/hell_sminki/normal/hell_redgrape.jpg',
        'snimki/hell_sminki/normal/hell_watermelon.jpg'
      ]},
      { heading:'ICE COFFE HELL', images:[
        'snimki/hell_sminki/ice_coffe/ice_coffe_capochino.png',
        'snimki/hell_sminki/ice_coffe/ice_coffe_caramel.png',
        'snimki/hell_sminki/ice_coffe/ice_coffe_coconut.png',
        'snimki/hell_sminki/ice_coffe/ice_coffe_doubleespresso.png',
        'snimki/hell_sminki/ice_coffe/ice_coffe_late.png',
        'snimki/hell_sminki/ice_coffe/ice_coffe_pinklatte.png',
        'snimki/hell_sminki/ice_coffe/ice_coffe_vanilia.png',
        'snimki/hell_sminki/ice_hell_distachio.png'
      ]}
    ]
  },
  voda:{
    title:'–í–û–î–ê', view:'water2',
    groups:[
      { heading:'Devin', pair:[
        {src:'snimki/produkti/–í–û–î–ê/golqma_devin.jpg', label:'–ì–æ–ª—è–º–∞ –î–µ–≤–∏–Ω', price:2.00},
        {src:'snimki/produkti/–í–û–î–ê/malka_devin.jpg', label:'–ú–∞–ª–∫–∞ –î–µ–≤–∏–Ω',  price:1.50}
      ]},
      { heading:'–ë–∞–Ω–∫—è', pair:[
        {src:'snimki/produkti/–í–û–î–ê/golqma_bankq.jpg', label:'–ì–æ–ª—è–º–∞ –ë–∞–Ω–∫—è', price:2.00},
        {src:'snimki/produkti/–í–û–î–ê/malka_bankq.jpg', label:'–ú–∞–ª–∫–∞ –ë–∞–Ω–∫—è',  price:1.50}
      ]}
    ]
  },
  gazirana_voda:{
    title:'–ì–ê–ó–ò–†–ê–ù–ê –í–û–î–ê', view:'water2',
    groups:[
      { heading:'–ú–∞—Ä–∫–∏', pair:[
        {src:'snimki/produkti/–ì–ê–ó–ò–†–ê–ù–ê_–í–û–î–ê/shveps.jpg',  label:'Schweppes', price:1.90},
        {src:'snimki/produkti/–ì–ê–ó–ò–†–ê–ù–ê_–í–û–î–ê/sprait.jpg',  label:'Sprite',    price:1.90}
      ]}
    ]
  },
  fanta:{ title:'–§–ê–ù–¢–ê', items:[
    {name:'–§–∞–Ω—Ç–∞ –ü–æ—Ä—Ç–æ–∫–∞–ª', price:2.00, img:'snimki/produkti/–§–ê–ù–¢–ê/fanta_portokal.jpg'},
    {name:'–§–∞–Ω—Ç–∞ –õ–∏–º–æ–Ω',    price:2.00, img:'snimki/produkti/–§–ê–ù–¢–ê/fanta_lemon.jpg'},
    {name:'–§–∞–Ω—Ç–∞ –õ–∞–π—á–∏',    price:2.00, img:'snimki/produkti/–§–ê–ù–¢–ê/fanta_laici.jpg'},
    {name:'–§–∞–Ω—Ç–∞ Tutti Frutti', price:2.00, img:'snimki/produkti/–§–ê–ù–¢–ê/fanta_tutti.jpg'},
    {name:'–§–∞–Ω—Ç–∞ –ó–µ–ª–µ–Ω–∞ —è–±—ä–ª–∫–∞', price:2.00, img:'snimki/produkti/–§–ê–ù–¢–ê/fanta_greenapple.jpg'},
    {name:'–§–∞–Ω—Ç–∞ –ë–æ—Ä–æ–≤–∏–Ω–∫–∞',     price:2.00, img:'snimki/produkti/–§–ê–ù–¢–ê/sinq_blueberry.jpg'}
  ]},
  studen_chai:{ title:'–°–¢–£–î–ï–ù –ß–ê–ô', items:[
    { name:'Fuze Tea –ì–æ—Ä—Å–∫–∏ –ø–ª–æ–¥', price:2.50, img:'snimki/produkti/–°–¢–£–î–ï–ù_–ß–ê–ô/fuze_tea_forest_frut.jpg' },
    { name:'Fuze Tea –ü—Ä–∞—Å–∫–æ–≤–∞',    price:2.50, img:'snimki/produkti/–°–¢–£–î–ï–ù_–ß–ê–ô/fuze_tea_praskova.jpg' }
  ]},
  kola:{ title:'–ö–û–õ–ê', items:[
    {name:'–ö–æ–ª–∞ –ö–µ–Ω',        price:2.00, img:'snimki/produkti/–ö–û–õ–ê/kolaken.jpg'},
    {name:'–ö–æ–ª–∞ –ö–µ–Ω Zero',   price:2.00, img:'snimki/produkti/–ö–û–õ–ê/kolakenzero.jpg'},
    {name:'–ö–æ–ª–∞ –ë—É—Ç–∏–ª–∫–∞',    price:2.50, img:'snimki/produkti/–ö–û–õ–ê/kolapvc.jpg'},
    {name:'–ö–æ–ª–∞ –ë—É—Ç–∏–ª–∫–∞ Zero',price:2.50, img:'snimki/produkti/–ö–û–õ–ê/kolapvczero.jpg'}
  ]},
  sok:{ title:'–°–û–ö', items:[
    {name:'Cappy –ü–æ—Ä—Ç–æ–∫–∞–ª', price:2.50, img:'snimki/produkti/–°–û–ö/cappy_orange.jpg'},
    {name:'Cappy –õ–∏–º–æ–Ω',    price:2.50, img:'snimki/produkti/–°–û–ö/cappy_lemon.jpg'}
  ]},
  airqn:{ title:'–ê–ô–†–Ø–ù', groups:[
    { heading:'–í–µ—Ä–µ—è', items:[
      {name:'–ê–π—Ä—è–Ω –í–µ—Ä–µ—è –ì–æ–ª—è–º', price:2.00, img:'snimki/produkti/–ê–ô–†–ê–ù/airan_vereq_golqm.jpg'},
      {name:'–ê–π—Ä—è–Ω –í–µ—Ä–µ—è –ú–∞–ª—ä–∫', price:1.50, img:'snimki/produkti/–ê–ô–†–ê–ù/airan_vereq_maluk.jpg'}
    ]},
    { heading:'Meggle', items:[
      {name:'–ê–π—Ä—è–Ω Meggle –ë—É—Ç–∏–ª–∫–∞', price:2.00, img:'snimki/produkti/–ê–ô–†–ê–ù/megle_airan_butilka.jpg'},
      {name:'–ê–π—Ä—è–Ω Meggle –ö–æ—Ñ–∞',    price:2.50, img:'snimki/produkti/–ê–ô–†–ê–ù/megle_airan_kofa.jpg'},
      {name:'–ê–π—Ä—è–Ω Meggle –ü–ª–æ–¥–æ–≤',  price:2.20, img:'snimki/produkti/–ê–ô–†–ê–ù/mwgle_airan_plodov.jpg'}
    ]}
  ]},
  xixo:{ title:'XIXO', items:[
    {name:'XIXO Cola', price:1.10, img:'snimki/produkti/–•–ò–•–û/xixo_cola.jpg'},
    {name:'XIXO Cherry Cola', price:1.10, img:'snimki/produkti/–•–ò–•–û/xixo_cherry_cola.jpg'},
    {name:'XIXO –î–∏–Ω—è', price:1.10, img:'snimki/produkti/–•–ò–•–û/xixo_dinq.jpg'},
    {name:'XIXO –ì–æ—Ä—Å–∫–∏ –ø–ª–æ–¥', price:1.10, img:'snimki/produkti/–•–ò–•–û/xixo_gorski_plod.jpg'},
    {name:'XIXO Green Fusion', price:1.10, img:'snimki/produkti/–•–ò–•–û/xixo_green_fusion.jpg'},
    {name:'XIXO –ö—Ä—É—à–∞', price:1.10, img:'snimki/produkti/–•–ò–•–û/xixo_krusha.jpg'},
    {name:'XIXO –õ–∏–º–æ–Ω', price:1.10, img:'snimki/produkti/–•–ò–•–û/xixo_limon.jpg'},
    {name:'XIXO –ú–∞–Ω–≥–æ –∏ –∞–Ω–∞–Ω–∞—Å', price:1.10, img:'snimki/produkti/–•–ò–•–û/xixo_mango_and_pineapple.jpg'},
    {name:'XIXO –†–æ–∑–æ–≤–∞ –ª–∏–º–æ–Ω–∞–¥–∞', price:1.10, img:'snimki/produkti/–•–ò–•–û/xixo_pink_lemonade.jpg'},
    {name:'XIXO –ü—Ä–∞—Å–∫–æ–≤–∞', price:1.10, img:'snimki/produkti/–•–ò–•–û/xixo_praskova.jpg'},
    {name:'XIXO –Ø–≥–æ–¥–∞', price:1.10, img:'snimki/produkti/–•–ò–•–û/xixo_qgoda.jpg'},
    {name:'XIXO Tutti Frutti', price:1.10, img:'snimki/produkti/–•–ò–•–û/xixo_tuti_fruity.jpg'}
  ]}
};

/* ===================== Helpers ===================== */
const toast = (msg)=>{ const t=document.getElementById('toast'); t.textContent=msg; t.style.display='block'; setTimeout(()=>t.style.display='none',1600); };
const money = (n)=> (Number(n||0).toFixed(2)+' –ª–≤');
const el = (tag, props={}, ...children)=>{
  const x=document.createElement(tag); Object.assign(x, props);
  for(const c of children){ if(typeof c==='string') x.appendChild(document.createTextNode(c)); else if(c) x.appendChild(c); }
  return x;
};
const normalizeProduct = (p)=>({
  name:  p.name || p.title || '–ü—Ä–æ–¥—É–∫—Ç',
  desc:  p.desc || '',
  price: Number(p.price||0),
  image: p.image || p.img || '/bbqsaitlogo.jpg',
  category: p.category || p.cat || p.type || '–î—Ä—É–≥–∏'
});
const genId = ()=> 'p_'+Date.now().toString(36)+'_'+Math.random().toString(36).slice(2,8);

/* ===================== –ü—É–±–ª–∏—á–µ–Ω —Ä–µ–Ω–¥–µ—Ä –Ω–∞ –ø—Ä–æ–º–æ—Ü–∏–∏ ===================== */
db.ref('/promotions/items').on('value', snap => {
  promoGrid.innerHTML = '';
  const obj = snap.val() || {};
  const items = Object.values(obj).filter(x => x && x.active !== false && !x.__deleted);

  if (items.length === 0) {
    promoGrid.appendChild(el('div', { style: 'opacity:.7' }, '–ù—è–º–∞ –∞–∫—Ç–∏–≤–Ω–∏ –ø—Ä–æ–º–æ—Ü–∏–∏.'));
    return;
  }

  items.forEach(p => {
    const A = p.parts?.[0] || {};
    const B = p.parts?.[1] || {};
    const totalPrice = Number(p.price || 0);

    const card = el('div', {
      className:'promo-card',
      'data-id': p.id || '',
      'data-price': String(totalPrice),
      'data-a': A.name || '',
      'data-b': B.name || ''
    },
      el('button', { className:'promo-del', title:'–ò–∑—Ç—Ä–∏–π —Ç–∞–∑–∏ –ø—Ä–æ–º–æ—Ü–∏—è', onclick:()=> tryDeletePromo(p.id) }, '‚úï'),
      el('div', { className:'promo-img' },
        el('img', { src: A.image || '/bbqsaitlogo.jpg', alt: A.name || '–ü—Ä–æ–¥—É–∫—Ç A', loading:'lazy' }),
        el('div', { className:'promo-overlay' }),
        el('span', { className:'promo-tag' }, '–ü–†–û–ú–û ‚Äî A'),
        el('div', { className:'promo-info' },
          el('div', { className:'promo-name' }, A.name || '‚Äî'),
          el('div', { className:'promo-desc' }, A.desc || '')
        )
      ),
      el('div', { className:'promo-img' },
        el('img', { src: B.image || '/bbqsaitlogo.jpg', alt: B.name || '–ü—Ä–æ–¥—É–∫—Ç B', loading:'lazy' }),
        el('div', { className:'promo-overlay' }),
        el('span', { className:'promo-tag' }, '–ü–†–û–ú–û ‚Äî B'),
        el('div', { className:'promo-info' },
          el('div', { className:'promo-name' }, B.name || '‚Äî'),
          el('div', { className:'promo-desc' }, B.desc || '')
        )
      )
    );

    card.appendChild(el('div', { className:'promo-price' }, money(totalPrice)));

const plusBtn = el('button', {
  className:'promo-plus',
  type:'button',
  title:'–î–æ–±–∞–≤–∏ –≤ –∫–æ–ª–∏—á–∫–∞—Ç–∞',
  onclick: (e)=>{
    const btn = e.currentTarget;

    // –¥–æ–±–∞–≤—è–Ω–µ –≤ –∫–æ–ª–∏—á–∫–∞—Ç–∞
    sendPromoToParent(card);

    // –≤–∏–∑—É–∞–ª–µ–Ω feedback: —Å—Ç–∞–≤–∞ —á–µ—Ä–µ–Ω –∏ ‚Äû‚úì‚Äú –∑–∞ 500ms, –ø–æ—Å–ª–µ –æ–±—Ä–∞—Ç–Ω–æ
    btn.classList.add('clicked');
    const oldText = btn.textContent;
    btn.textContent = '‚úì';
    setTimeout(()=>{
      btn.classList.remove('clicked');
      btn.textContent = oldText || '+';
    }, 500);
  }
}, '+');

    card.appendChild(plusBtn);

    promoGrid.appendChild(card);
  });

  // –ø–æ–∫–∞–∑–≤–∞–π X —Å–∞–º–æ –≤ Admin —Ä–µ–∂–∏–º
  toggleDeleteButtons();
});

/* ===================== Admin unlock ===================== */
adminBtn.addEventListener('click', ()=>{
  if (isAdmin){
    setAdminUI(false);
    toast('Admin –∏–∑–∫–ª—é—á–µ–Ω');
    return;
  }
  const pass = prompt('–í—ä–≤–µ–¥–∏ –ø–∞—Ä–æ–ª–∞ (admin):');
  if (pass === ADMIN_PASS){
    setAdminUI(true);
    // –ø–æ –∏–∑–±–æ—Ä: –æ—Ç–≤–∞—Ä—è –∫–∞—Ç–∞–ª–æ–≥–∞ –≤–µ–¥–Ω–∞–≥–∞
    slide.classList.add('open');
    if (rows.length===0) addRow();
    renderCategories();
    toast('Admin –∞–∫—Ç–∏–≤–µ–Ω');
  } else {
    toast('–ì—Ä–µ—à–Ω–∞ –ø–∞—Ä–æ–ª–∞.');
  }
});

/* ===================== –ö–∞—Ç–∞–ª–æ–≥ –æ—Ç Firebase (–∑–∞ —Ç—ä—Ä—Å–µ–Ω–µ –ø–æ –≤—Å–∏—á–∫–∏) ===================== */
db.ref('/products').on('value',(snap)=>{
  const val = snap.val() || {};
  catalog = Object.values(val).map(normalizeProduct);
});

/* ===================== –ö–∞—Ç–∞–ª–æ–≥ UI (–ù–ï –ü–ò–ü–ê–ú–ï –õ–û–ì–ò–ö–ê–¢–ê) ===================== */
const openSlide = ()=>{ slide.classList.add('open'); renderCategories(); };
const closeSlideFn = ()=> slide.classList.remove('open');
catalogBtn.addEventListener('click', openSlide);
closeSlide.addEventListener('click', closeSlideFn);
backBtn.addEventListener('click', ()=> renderCategories());

function renderCategories(){
  view = 'cats'; currentKey=null;
  slideTitle.textContent = '–ö–∞—Ç–∞–ª–æ–≥ ¬∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏';
  backBtn.style.display = 'none';
  catalogEl.innerHTML = '';
  catalogEl.appendChild(el('div',{className:'s-title'}, '–ö–∞—Ç–µ–≥–æ—Ä–∏–∏'));
  CAT_ORDER.forEach(key=>{
    const label = CAT_TITLES[key];
    const img = CAT_THUMBS[key] || '/bbqsaitlogo.jpg';
    const card = el('div',{className:'s-cat'},
      el('img',{src:img, alt:label, loading:'lazy'}),
      el('div',{className:'meta'},
        el('div',{className:'nm'}, label),
        el('div',{className:'ds'}, '–û—Ç–≤–æ—Ä–∏ –ø—Ä–æ–¥—É–∫—Ç–∏')
      )
    );
    card.addEventListener('click', ()=> renderCategory(key));
    catalogEl.appendChild(card);
  });
}
function prettyLabel(src){
  let f = src.split('/').pop().split('.')[0].toLowerCase();
  f = f.replace(/^hell_/,'').replace(/^ice_coffe_/,'').replace(/^ice_hell_/,'');
  const map = {apple:'Apple', clasic:'Classic', classic:'Black Cherry', redgrape:'Red Grape',
               watermelon:'Watermelon', capochino:'Cappuccino', cappuccino:'Cappuccino',
               caramel:'Salted Caramel', coconut:'Coconut', doubleespresso:'Double Espresso',
               doublespresso:'Double Espresso', late:'Latte', latte:'Latte',
               pinklatte:'Pink Latte', vanilia:'Vanilla', vanilla:'Vanilla',
               distachio:'Pistachio', pistachio:'Pistachio', slimvanilla:'Vanilla'};
  if(map[f]) return map[f];
  return f.replace(/[_-]+/g,' ').replace(/\b\w/g,m=>m.toUpperCase());
}
function makeDragPayload(p, category){
  return JSON.stringify({
    name: p.name || p.label || prettyLabel(p.src||''),
    desc: p.desc || '',
    price: Number(p.price||0),
    image: p.img || p.image || p.src || '/bbqsaitlogo.jpg',
    category: category || ''
  });
}
function renderCategory(key){
  const data = CATALOG[key];
  currentKey = key;
  view = 'cat';
  slideTitle.textContent = '–ö–∞—Ç–∞–ª–æ–≥ ¬∑ ' + (data?.title || CAT_TITLES[key] || key.toUpperCase());
  backBtn.style.display = '';
  catalogEl.innerHTML = '';

  if(data?.view === 'water2'){
    data.groups.forEach(g=>{
      catalogEl.appendChild(el('div',{className:'s-title'}, g.heading));
      const wrap = el('div',{className:'s-water'});
      g.pair.forEach(p=>{
        const card = el('div',{className:'s-wcard', draggable:true},
          el('img',{src:p.src, alt:p.label}),
          el('div',{className:'s-wname'}, p.label),
          el('div',{className:'s-wprice'}, money(p.price))
        );
        card.addEventListener('dragstart', e=> e.dataTransfer.setData('application/json', makeDragPayload({name:p.label, price:p.price, img:p.src}, data.title)));
        wrap.appendChild(card);
      });
      catalogEl.appendChild(wrap);
    });
    return;
  }
  if(data?.view === 'gallery'){
    data.groups.forEach(g=>{
      catalogEl.appendChild(el('div',{className:'s-title'}, g.heading));
      const grid = el('div',{className:'s-gallery'});
      const price = data.hellPrice ?? 2.00;
      g.images.forEach(src=>{
        const label = prettyLabel(src);
        const tile = el('div',{className:'s-tile', draggable:true, title:label},
          el('img',{src, alt:label}),
          el('div',{className:'s-price'}, money(price)),
          el('div',{className:'s-cap'}, label)
        );
        tile.addEventListener('dragstart', e=> e.dataTransfer.setData('application/json', makeDragPayload({name:label, price, img:src}, data.title)));
        grid.appendChild(tile);
      });
      catalogEl.appendChild(grid);
    });
    return;
  }
  if(Array.isArray(data?.groups)){
    data.groups.forEach(g=>{
      catalogEl.appendChild(el('div',{className:'s-title'}, g.heading));
      g.items.forEach(p=>{
        const card = el('div',{className:'s-card', draggable:true},
          el('img',{src:p.img || '/bbqsaitlogo.jpg', alt:p.name}),
          el('div',{className:'nm'}, p.name),
          el('div',{className:'pr'}, money(p.price||0))
        );
        card.addEventListener('dragstart', e=> e.dataTransfer.setData('application/json', makeDragPayload(p, data.title)));
        catalogEl.appendChild(card);
      });
    });
    return;
  }
  const items = data?.items || [];
  items.forEach(p=>{
    const card = el('div',{className:'s-card', draggable:true},
      el('img',{src:p.img || '/bbqsaitlogo.jpg', alt:p.name}),
      el('div',{className:'nm'}, p.name),
      el('div',{className:'pr'}, money(p.price||0))
    );
    card.addEventListener('dragstart', e=> e.dataTransfer.setData('application/json', makeDragPayload(p, data.title)));
    catalogEl.appendChild(card);
  });
  if(items.length===0){
    catalogEl.appendChild(el('div',{style:'opacity:.7'}, '–ù—è–º–∞ –ø—Ä–æ–¥—É–∫—Ç–∏.'));
  }
}
searchEl.addEventListener('input', ()=>{
  const q = searchEl.value.trim().toLowerCase();
  if(view!=='cat' || !currentKey){
    if(!q){ renderCategories(); return; }
    const filtered = (catalog||[]).filter(p =>
      (p.name+' '+(p.desc||'')+' '+(p.category||'')).toLowerCase().includes(q)
    );
    slideTitle.textContent = '–¢—ä—Ä—Å–µ–Ω–µ';
    backBtn.style.display = '';
    catalogEl.innerHTML = '';
    filtered.forEach(p=>{
      const card = el('div',{className:'s-card', draggable:true},
        el('img',{src:p.image || '/bbqsaitlogo.jpg', alt:p.name}),
        el('div',{className:'nm'}, p.name),
        el('div',{className:'pr'}, money(p.price||0))
      );
      card.addEventListener('dragstart', e=> e.dataTransfer.setData('application/json', JSON.stringify({
        name:p.name, desc:p.desc||'', price:Number(p.price||0), image:p.image||'/bbqsaitlogo.jpg', category:p.category||''
      })));
      catalogEl.appendChild(card);
    });
    if(filtered.length===0) catalogEl.appendChild(el('div',{style:'opacity:.7'}, '–ù—è–º–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏.'));
    return;
  }

  const data = CATALOG[currentKey];
  if(!q){ renderCategory(currentKey); return; }

  catalogEl.innerHTML = '';
  slideTitle.textContent = '–ö–∞—Ç–∞–ª–æ–≥ ¬∑ ' + (data?.title || CAT_TITLES[currentKey]);

  const collectItems = [];
  if(data.view==='gallery'){
    const price = data.hellPrice ?? 2.00;
    data.groups.forEach(g=>{
      g.images.forEach(src=>{
        const label = prettyLabel(src);
        if(label.toLowerCase().includes(q)){
          collectItems.push({name:label, price, img:src});
        }
      });
    });
  } else if(data.view==='water2'){
    data.groups.forEach(g=>{
      g.pair.forEach(p=>{
        const name = p.label;
        if(name.toLowerCase().includes(q)){
          collectItems.push({name, price:p.price, img:p.src});
        }
      });
    });
  } else if(Array.isArray(data.groups)){
    data.groups.forEach(g=>{
      g.items.forEach(p=>{
        if((p.name||'').toLowerCase().includes(q)) collectItems.push(p);
      });
    });
  } else {
    (data.items||[]).forEach(p=>{
      if((p.name||'').toLowerCase().includes(q)) collectItems.push(p);
    });
  }

  if(collectItems.length){
    collectItems.forEach(p=>{
      const card = el('div',{className:'s-card', draggable:true},
        el('img',{src:p.img || '/bbqsaitlogo.jpg', alt:p.name}),
        el('div',{className:'nm'}, p.name),
        el('div',{className:'pr'}, money(p.price||0))
      );
      card.addEventListener('dragstart', e=> e.dataTransfer.setData('application/json', makeDragPayload(p, data.title)));
      catalogEl.appendChild(card);
    });
  }else{
    catalogEl.appendChild(el('div',{style:'opacity:.7'}, '–ù—è–º–∞ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏.'));
  }
});

/* ===================== Builder: A + B + —Ü–µ–Ω–∞ ===================== */
function productChip(p, onRemove){
  const c = el('div',{className:'chip'},
    el('img',{src:p.image, alt:p.name}),
    el('div',{className:'meta'},
      el('span',{className:'nm'}, p.name),
      el('span',{className:'ds'}, (p.desc||'') + (p.desc?' ¬∑ ':'') + money(p.price))
    ),
    el('span',{className:'x', title:'–ü—Ä–µ–º–∞—Ö–Ω–∏', onclick:()=>{ c.remove(); onRemove && onRemove(); }}, '‚úï')
  );
  c._data = p;
  return c;
}
function makeDropCell(onSet){
  const dz = el('div',{className:'drop'});
  dz.addEventListener('dragover', e=>{ e.preventDefault(); dz.style.borderColor='#ffffff66'; });
  dz.addEventListener('dragleave', ()=>{ dz.style.borderColor='#ffffff2f'; });
  dz.addEventListener('drop', e=>{
    e.preventDefault(); dz.style.borderColor='#ffffff2f';
    const raw = e.dataTransfer.getData('application/json');
    if(!raw) return;
    try{
      const p = JSON.parse(raw);
      dz.innerHTML='';
      dz.appendChild(productChip(p, ()=>{ dz.innerHTML=''; onSet(null); }));
      onSet(p);
    }catch(_){}
  });
  return dz;
}
function renderRows(){
  rowsWrap.innerHTML='';
  rows.forEach((r, idx)=>{
    let A = r.A || null, B = r.B || null;
    const dzA = makeDropCell((p)=>{ rows[idx].A = p; });
    const dzB = makeDropCell((p)=>{ rows[idx].B = p; });
    if(A) dzA.appendChild(productChip(A, ()=>{ rows[idx].A=null; }));
    if(B) dzB.appendChild(productChip(B, ()=>{ rows[idx].B=null; }));
    const price = el('input',{className:'price-input', type:'number', step:'0.01', min:'0', value: r.price ?? ''});
    price.addEventListener('input', ()=> rows[idx].price = Number(price.value||0));

    const row = el('div',{className:'row'},
      dzA,
      el('div',{className:'pluscell'}, '+'),
      dzB,
      price,
      el('button',{className:'row-del', title:'–ò–∑—Ç—Ä–∏–π —Ä–µ–¥', onclick:()=>{ rows.splice(idx,1); renderRows(); }}, '‚úï')
    );
    rowsWrap.appendChild(row);
  });
}
function addRow(){ rows.push({A:null,B:null,price:null}); renderRows(); }
addRowBtn.addEventListener('click', addRow);

/* ===================== –ó–∞–ø–∏—Å –Ω–∞ –ø—Ä–æ–º–æ—Ü–∏–∏ (BAT–°H update –∫—ä–º /promotions/items) ===================== */
saveBtn.addEventListener('click', async () => {
  if (!isAdmin) { toast('–ü—ä—Ä–≤–æ –æ—Ç–∫–ª—é—á–∏ Admin.'); return; }

  const toAppend = [];
  for (const r of rows) {
    if (!r.A || !r.B || !(r.price > 0)) continue;
    const id = genId();
    toAppend.push({
      path: '/promotions/items/' + id,
      data: {
        id,
        parts: [
          { name:r.A.name, desc:r.A.desc||'', price:Number(r.A.price||0), image:r.A.image||'/bbqsaitlogo.jpg' },
          { name:r.B.name, desc:r.B.desc||'', price:Number(r.B.price||0), image:r.B.image||'/bbqsaitlogo.jpg' }
        ],
        price: Number(r.price||0),
        createdAt: Date.now(),
        active: true,
        __admin_pass: ADMIN_PASS
      }
    });
  }

  if (toAppend.length === 0) { toast('–î–æ–±–∞–≤–∏ –ø–æ–Ω–µ –µ–¥–∏–Ω —Ä–µ–¥ —Å A, B –∏ —Ü–µ–Ω–∞.'); return; }

  try {
    const updates = {};
    toAppend.forEach(x => { updates[x.path] = x.data; });
    await db.ref().update(updates);
    toast(`–î–æ–±–∞–≤–µ–Ω–∏: ${toAppend.length} –ø—Ä–æ–º–æ—Ü–∏–∏.`);
    rows = []; addRow(); renderRows();
  } catch (e) {
    console.error('DB write error:', e);
    toast(`–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∑–∞–ø–∏—Å: ${e.code || e.message || e}`);
  }
});

/* ===================== –ò–∑—Ç—Ä–∏–≤–∞–Ω–µ –ø–æ id (soft delete) ===================== */
async function tryDeletePromo(id){
  if (!isAdmin) return;
  if (!id) { toast('–õ–∏–ø—Å–≤–∞ ID –Ω–∞ –ø—Ä–æ–º–æ—Ü–∏—è.'); return; }
  const ok = confirm('–°–∏–≥—É—Ä–Ω–∏ –ª–∏ —Å—Ç–µ, —á–µ –∏—Å–∫–∞—Ç–µ –¥–∞ –∏–∑—Ç—Ä–∏–µ—Ç–µ —Ç–∞–∑–∏ –ø—Ä–æ–º–æ—Ü–∏—è?');
  if (!ok) return;

  try {
    await db.ref('/promotions/items/' + id).update({
      __deleted: true,
      active: false,
      updatedAt: Date.now(),
      __admin_pass: ADMIN_PASS
    });
    toast('–ü—Ä–æ–º–æ—Ü–∏—è—Ç–∞ –µ –∏–∑—Ç—Ä–∏—Ç–∞.');
  } catch(e) {
    console.error('DB delete error:', e);
    toast(`–ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –∏–∑—Ç—Ä–∏–≤–∞–Ω–µ: ${e.code || e.message || e}`);
  }
}

function sendPromoToParent(card){
  // 1) –¶–µ–Ω–∞: dataset -> –±–µ–π–¥–∂
  const fromDataset = () => {
    const raw = card?.dataset?.price;
    if (raw == null || raw === "") return NaN;
    const n = Number.parseFloat(String(raw).replace(",", "."));
    return Number.isFinite(n) ? n : NaN;
  };
  const fromBadge = () => {
    const txt = card.querySelector(".promo-price")?.textContent || "";
    const n = Number.parseFloat(
      txt.replace(/\s+/g,"").replace(/–ª–≤\.?/i,"").replace(",", ".")
    );
    return Number.isFinite(n) ? n : NaN;
  };

  let price = fromDataset();
  if (!Number.isFinite(price) || price <= 0) price = fromBadge();
  if (!Number.isFinite(price)) price = 0;

  // 2) –ò–º–µ–Ω–∞
  const a = (card.dataset.a || "").trim();
  const b = (card.dataset.b || "").trim();
  const leftName  = card.querySelector('.promo-img:nth-child(2) .promo-name')?.textContent.trim() || a;
  const rightName = card.querySelector('.promo-img:nth-child(3) .promo-name')?.textContent.trim() || b;
  const finalA = a || leftName || "A";
  const finalB = b || rightName || "B";

  // 3) –°–Ω–∏–º–∫–∞
  const img = card.querySelector(".promo-img img")?.src || "/bbqsaitlogo.jpg";

  // 4) Payload
  const payload = {
    type: "bbq:addPromo",
    name: `–ü—Ä–æ–º–æ—Ü–∏—è ${finalA} + ${finalB}`,
    price: price,
    img: img,
    items: [{ name: finalA }, { name: finalB }]
  };

  window.parent?.postMessage(payload, "*");
}
  </script>
</body>
</html>
