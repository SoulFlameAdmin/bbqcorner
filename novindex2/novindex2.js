/* novindex2.js */
"use strict";

/* ===========================
   üß≠ –ü–™–¢–ò–©–ê –ò –ü–û–ú–û–©–ù–ò –ù–ï–©–ê
   =========================== */

/* üî∂ –ü—Ä–æ–º–æ—Ü–∏–∏: –ª–æ–≥–æ –∏ –ª–∏–Ω–∫–æ–≤–µ (—Å–∞–º–æ –∑–∞ –º–∏–Ω–∏–∞—Ç—é—Ä–∞—Ç–∞ –≤ —Å–∞–π–¥–±–∞—Ä–∞) */
const PROMO_IMG = (location.protocol === "file:")
  ? "file:///E:/BBQ_SITE/promociqlogo.jpg"
  : "/promociqlogo.jpg";
const PROMO_LINK_LOCAL = "file:///E:/BBQ_SITE/index7.html";
const PROMO_LINK_WEB   = "/index7.html";

/* –º–∞–ª—ä–∫ helper –∑–∞ –±–µ–∑–æ–ø–∞—Å–µ–Ω —Ç–µ–∫—Å—Ç –≤ HTML */
const esc = (s) => String(s)
  .replace(/&/g,"&amp;")
  .replace(/</g,"&lt;")
  .replace(/>/g,"&gt;")
  .replace(/"/g,"&quot;");

/* –¶–µ–Ω–∏ ‚Äì –∫–æ–Ω–≤–µ—Ä—Ç–æ—Ä */
const BGN_PER_EUR = 1.95583;
const fmtLv  = v => (Number(v)||0).toFixed(2).replace(".",",") + " –ª–≤.";
const fmtEur = v => ((Number(v)||0) / BGN_PER_EUR).toFixed(2).replace(".",",") + " ‚Ç¨";

/* ‚ûú –ù–∞ —Ç–µ–ª–µ—Ñ–æ–Ω –º–µ—Å—Ç–∏ –±—É—Ç–æ–Ω–∞ —Ç–æ—á–Ω–æ –≤–¥—è—Å–Ω–æ –æ—Ç —Ü–µ–Ω–∞—Ç–∞ */
function ensureMobilePlusRight(){
  const isPhone = window.matchMedia("(max-width:900px)").matches;
  if (!isPhone) return;

  document.querySelectorAll(".product .pad").forEach(pad => {
    const price = pad.querySelector(".price-badge");
    const btn   = pad.querySelector(".mobile-add-btn") || pad.querySelector(".add-btn");
    if (!price || !btn) return;

    let row = pad.querySelector(".price-plus");
    if (!row){
      row = document.createElement("div");
      row.className = "price-plus";
      price.replaceWith(row);
      row.appendChild(price);
    }
    row.appendChild(btn);
    btn.style.display = "inline-flex";
    btn.style.width   = "auto";
    btn.style.margin  = "0";
  });
}
window.addEventListener("load",  ensureMobilePlusRight);
window.addEventListener("resize", ensureMobilePlusRight);

/* ‚ûú –£–Ω–∏–≤–µ—Ä—Å–∞–ª–Ω–æ: –≥–∞—Ä–∞–Ω—Ç–∏—Ä–∞, —á–µ –∏–º–∞ –±—É—Ç–æ–Ω "+" —Å–ª–µ–¥ —Ü–µ–Ω–∞—Ç–∞ –∏ –≥–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–∞ (–∫–∞—Ç–æ –ø—Ä–∏ –≤–æ–¥–∞) */
function ensurePlusRightUniversal(){
  const hosts = document.querySelectorAll('.product, .tile, .water-card');
  hosts.forEach(card => {
    const pad   = card.querySelector('.pad') || card;
    const price = pad.querySelector('.price-badge') || card.querySelector('.price-badge');
    if (!price) return;

    let plus = pad.querySelector('.add-btn') ||
               pad.querySelector('.mobile-add-btn') ||
               card.querySelector('.add-btn');

    if (!plus) {
      plus = document.createElement('button');
      plus.type = 'button';
      plus.className = 'add-btn';
      plus.textContent = '+';
    } else {
      plus.classList.add('add-btn');
      plus.classList.remove('mobile-add-btn');
    }

    if (plus !== price.nextElementSibling) {
      price.insertAdjacentElement('afterend', plus);
    }
  });
}

/* ===========================
   üì¶ –ö–û–õ–ò–ß–ö–ê
   =========================== */

const CART = [];
const cartBtn      = document.getElementById("cartBtn");
const cartCount    = document.getElementById("cartCount");
const cartOverlay  = document.getElementById("cartOverlay");
const cartItemsEl  = document.getElementById("cartItems");
const cartTotalRow = document.getElementById("cartTotalRow");
const cartTotal    = document.getElementById("cartTotal");
const orderNowBtn  = document.getElementById("orderNow");

/* ====== LS –∫–ª—é—á–æ–≤–µ (index2 -> index3) ====== */
const LS_CART_ITEMS = "bbq_cart_items";
const LS_CART_TOTAL = "bbq_cart_total";
const LS_ORDER_NOTE = "bbq_order_note";
const noteWrapper   = document.getElementById("noteWrapper");
const orderNoteEl   = document.getElementById("orderNote");

/* –î–æ–±–∞–≤—è–Ω–µ –∫—ä–º –∫–æ–ª–∏—á–∫–∞—Ç–∞ */
function addToCart(item){
  CART.push(item);
  updateCartUI();
}

/* –û—Å–Ω–æ–≤–µ–Ω —Ä–µ–Ω–¥–µ—Ä –Ω–∞ –∫–æ–ª–∏—á–∫–∞—Ç–∞ */
function updateCartUI(){
  // –±—Ä–æ–π–∫–∞ –≤—ä—Ä—Ö—É –±—É—Ç–æ–Ω–∞
  cartCount.textContent = CART.length;

  // –ø—Ä–∞–∑–Ω–∞ –∫–æ–ª–∏—á–∫–∞
  if (CART.length === 0){
    cartItemsEl.innerHTML = `<div class="cart-empty">–ö–æ–ª–∏—á–∫–∞—Ç–∞ –µ –ø—Ä–∞–∑–Ω–∞.</div>`;
    cartTotalRow.style.display = "none";
    orderNowBtn.disabled = true;
    noteWrapper.style.display = "none";
    persistCartSnapshot();
    return;
  }

  // —Ä–µ–¥–æ–≤–µ + –≤–∏–¥–∏–º–∏ –¥–æ–±–∞–≤–∫–∏
  cartItemsEl.innerHTML = CART.map(it => {
    const addonsLine = it.addons?.length
      ? `<div style="font-size:12px; opacity:.8; margin-top:2px">
           + ${it.addons.map(a=>`${esc(a.label)} (${fmtLv(a.price)})`).join(", ")}
         </div>` : "";
    return `
      <div class="cart-item">
        <img src="${it.img}" alt="${esc(it.baseName || it.name)}">
        <div>
          <div class="name">${esc(it.baseName || it.name)}</div>
          ${addonsLine}
          <div class="price" style="margin-top:4px">
            ${fmtLv(it.price)} <span style="opacity:.75">(${fmtEur(it.price)})</span>
          </div>
        </div>
        <div><button class="add-btn" data-remove="${it._id}">‚úï</button></div>
      </div>`;
  }).join("");

  // –ø—Ä–µ–º–∞—Ö–≤–∞–Ω–µ
  cartItemsEl.querySelectorAll("[data-remove]").forEach((btn)=>{
    btn.addEventListener("click", ()=>{
      const id = btn.getAttribute("data-remove");
      const i = CART.findIndex(x => String(x._id) === id);
      if (i>=0){ CART.splice(i,1); updateCartUI(); }
    });
  });

  // —Ç–æ—Ç–∞–ª + UI
  const total = CART.reduce((s, x)=> s + (Number(x.price)||0), 0);
  cartTotal.textContent = `${fmtLv(total)}  (${fmtEur(total)})`;
  cartTotalRow.style.display = "";
  orderNowBtn.disabled = false;
  noteWrapper.style.display = "block";

  persistCartSnapshot();

  // –∑–∞–ø–∏—Å –Ω–∞ –±–µ–ª–µ–∂–∫–∞—Ç–∞ (–≤—Ä—ä–∑–≤–∞–º–µ —Å–∞–º–æ –≤–µ–¥–Ω—ä–∂)
  if (!orderNoteEl.dataset.bound) {
    orderNoteEl.addEventListener("input", () => {
      localStorage.setItem(LS_ORDER_NOTE, orderNoteEl.value);
    });
    orderNoteEl.dataset.bound = "1";
  }
}

function restoreOrderNote(){
  orderNoteEl.value = localStorage.getItem(LS_ORDER_NOTE) || "";
}

function persistCartSnapshot(){
  try{
    const itemsSnapshot = CART.map(({_id, name, baseName, price, basePrice, img, addons}) => ({
      _id, name, baseName, price, basePrice, img, addons: addons || []
    }));
    const total = CART.reduce((s, x)=> s + (Number(x.price)||0), 0);
    localStorage.setItem(LS_CART_ITEMS, JSON.stringify(itemsSnapshot));
    localStorage.setItem(LS_CART_TOTAL, String(total));
    localStorage.setItem(LS_ORDER_NOTE, orderNoteEl.value || "");
  }catch(e){ console.warn("LS error:", e); }
}

function restoreCartFromLS() {
  try {
    const raw = localStorage.getItem(LS_CART_ITEMS);
    const items = JSON.parse(raw || "[]");

    if (Array.isArray(items) && items.length > 0) {
      items.forEach(it => CART.push({
        _id: it._id || (Date.now() + "" + Math.random()),
        name: it.name || "–ë–µ–∑ –∏–º–µ",
        baseName: it.baseName || it.name || "–ë–µ–∑ –∏–º–µ",
        price: Number(it.price) || Number(it.basePrice) || 0,
        basePrice: Number(it.basePrice) || Number(it.price) || 0,
        img: it.img || "",
        addons: Array.isArray(it.addons) ? it.addons : []
      }));
    }

    updateCartUI();
    restoreOrderNote();
  } catch (e) {
    console.warn("‚ö†Ô∏è –ì—Ä–µ—à–∫–∞ –ø—Ä–∏ –≤—ä–∑—Å—Ç–∞–Ω–æ–≤—è–≤–∞–Ω–µ –Ω–∞ –∫–æ–ª–∏—á–∫–∞—Ç–∞ –æ—Ç LocalStorage:", e);
  }
}

/* –û—Ç–≤–∞—Ä—è–Ω–µ/–∑–∞—Ç–≤–∞—Ä—è–Ω–µ –Ω–∞ –º–æ–¥–∞–ª–∞ */
function openCart(){
  updateCartUI();
  cartOverlay.style.display = "flex";
  cartOverlay.setAttribute("aria-hidden","false");
  cartBtn.setAttribute("aria-expanded","true");   // a11y
}
function closeCart(){
  cartOverlay.style.display = "none";
  cartOverlay.setAttribute("aria-hidden","true");
  cartBtn.setAttribute("aria-expanded","false");  // a11y
}
document.getElementById("cartClose").addEventListener("click", closeCart);
cartOverlay.addEventListener("click", (e)=>{ if(e.target === cartOverlay) closeCart(); });
cartBtn.addEventListener("click", openCart);
// –∑–∞—Ç–≤–∞—Ä—è–Ω–µ —Å Escape
document.addEventListener("keydown", (e)=>{
  if (e.key === "Escape" && cartOverlay.style.display === "flex") closeCart();
});

/* –ü–æ—Ä—ä—á–∞–π —Å–µ–≥–∞ ‚Üí index3.html (–ª–æ–∫–∞–ª–Ω–æ –∏–ª–∏ —É–µ–±) */
orderNowBtn.addEventListener("click", ()=>{
  if (CART.length === 0) return;
  persistCartSnapshot();
  const target = (location.protocol === "file:") ? "file:///E:/BBQ_SITE/index3.html" : "index3.html";
  window.location.href = target;
});

/* ===========================
   üñºÔ∏è –ö–ê–¢–ï–ì–û–†–ò–ò/–ö–ê–¢–ê–õ–û–ì
   =========================== */

/* –ú–∏–Ω–∏–∞—Ç—é—Ä–∏ (—Å–∞–π–¥–±–∞—Ä) */
const CAT_THUMBS = {
  promocii: PROMO_IMG,
  burgeri:"snimki/produkti/1menu/burger.jpg",
  palachinki:"snimki/produkti/1menu/palachinki.jpg",
  strandzhanki:"snimki/produkti/1menu/strandjanka.jpg",
  kartofi:"snimki/produkti/1menu/kartofi.jpg",
  salati:"snimki/produkti/1menu/salata.jpg",
  portsii:"snimki/produkti/1menu/porciq.jpg",
  sosove:"snimki/produkti/1menu/sosove.jpg",
  dobavki:"snimki/produkti/1menu/dobavki.jpg",
  deserti:"snimki/produkti/1menu/desert.jpg",
  bezalkoholni:"snimki/produkti/1menu/bezalkoholno.jpg",
  bira:"snimki/produkti/1menu/bira.jpg",
  hell:"snimki/produkti/1menu/hell.jpg",
  voda:"snimki/produkti/–í–û–î–ê/voda_snimka.jpg",
  gazirana_voda:"snimki/produkti/–ì–ê–ó–ò–†–ê–ù–ê_–í–û–î–ê/gaziranavoda_snimka.jpg",
  fanta:"snimki/produkti/–§–ê–ù–¢–ê/fanta_logo.jpg",
  studen_chai:"snimki/produkti/–°–¢–£–î–ï–ù_–ß–ê–ô/studen_chai_logo.jpg",
  kola:"snimki/produkti/–ö–û–õ–ê/kola_logo.jpg",
  sok:"snimki/produkti/–°–û–ö/cappy_logo.jpg",
  airqn:"snimki/produkti/–ê–ô–†–ê–ù/vereq_logo.jpg",
  xixo:"snimki/produkti/–•–ò–•–û/xixo_logo.jpg"
};

/* === –î–û–ë–ê–í–ö–ò (—É–Ω–∏–≤–µ—Ä—Å–∞–ª–Ω–∏) === */
const ADDONS = {
  pitka:   { code:"pitka",   label:"–ü–∏—Ç–∫–∞",          price:1.50 },
  raz:     { code:"raz",     label:"–†–∞–∑—è–¥–∫–∞ 100 –≥—Ä", price:1.50 },
  ketchup: { code:"ketchup", label:"–ö–µ—Ç—á—É–ø",      price:0 },
  mayo:    { code:"mayo",    label:"–ú–∞–π–æ–Ω–µ–∑–∞",    price:0 },
  mustard: { code:"mustard", label:"–ì–æ—Ä—á–∏—Ü–∞",     price:0 },
  chili:   { code:"chili",   label:"–õ—é—Ç–æ",        price:0 },
  sharena: { code:"sharena", label:"–®–∞—Ä–µ–Ω–∞ —Å–æ–ª",  price:0 },
};

/* –ö–∞—Ç–∞–ª–æ–≥ —Å —Ü–µ–Ω–∏ –≤ –ª–≤. */
const CATALOG = {
  burgeri:{title:"–°–ê–ù–î–í–ò–ß–ò",items:[
    {name:"–ö–û–ù–°–ö–ê –ü–õ–ï–°–ö–ê–í–ò–¶–ê", price:9.00, img:"snimki/produkti/2menu/konski.jpg",
      desc:"–ö–æ–Ω—Å–∫–æ –º–µ—Å–æ –Ω–∞ –∂–∞—Ä —Å—ä—Å —Å–≤–µ–∂–∏ –∑–µ–ª–µ–Ω—á—É—Ü–∏, —Ç—Ä–∏ –≤–∏–¥–∞ —Å–æ—Å–æ–≤–µ (–∫–µ—Ç—á—É–ø, –º–∞–π–æ–Ω–µ–∑–∞, –≥–æ—Ä—á–∏—Ü–∞), –ø—Ä–µ—Å–Ω–∏ –∫–∞—Ä—Ç–æ—Ñ–∫–∏ –∏ –ø—Ä—è—Å–Ω–∞ –ø–∏—Ç–∫–∞ (—Å–∞–º—É–Ω)."},
    {name:"–¢–ï–õ–ï–®–ö–ê –ü–õ–ï–°–ö–ê–í–ò–¶–ê", price:9.00, img:"snimki/produkti/2menu/sharska.jpg",
      desc:"–¢–µ–ª–µ—à–∫–æ –º–ª—è–Ω–æ –º–µ—Å–æ –Ω–∞ –∂–∞—Ä —Å—ä—Å —Å–≤–µ–∂–∏ –∑–µ–ª–µ–Ω—á—É—Ü–∏, —Ç—Ä–∏ –≤–∏–¥–∞ —Å–æ—Å–æ–≤–µ (–∫–µ—Ç—á—É–ø, –º–∞–π–æ–Ω–µ–∑–∞, –≥–æ—Ä—á–∏—Ü–∞), –ø—Ä–µ—Å–Ω–∏ –∫–∞—Ä—Ç–æ—Ñ–∫–∏ –∏ –ø—Ä—è—Å–Ω–∞ –ø–∏—Ç–∫–∞ (—Å–∞–º—É–Ω)."},
    {name:"–®–ê–†–°–ö–ê –ü–õ–ï–°–ö–ê–í–ò–¶–ê", price:9.50, img:"snimki/produkti/2menu/sharska.jpg",
      desc:"–¢–µ–ª–µ—à–∫–æ –º–ª—è–Ω–æ –º–µ—Å–æ —Å –∫–∞—à–∫–∞–≤–∞–ª –Ω–∞ –∂–∞—Ä —Å—ä—Å —Å–≤–µ–∂–∏ –∑–µ–ª–µ–Ω—á—É—Ü–∏, —Ç—Ä–∏ –≤–∏–¥–∞ —Å–æ—Å–æ–≤–µ (–∫–µ—Ç—á—É–ø, –º–∞–π–æ–Ω–µ–∑–∞, –≥–æ—Ä—á–∏—Ü–∞), –ø—Ä–µ—Å–Ω–∏ –∫–∞—Ä—Ç–æ—Ñ–∫–∏ –∏ –ø—Ä—è—Å–Ω–∞ –ø–∏—Ç–∫–∞ (—Å–∞–º—É–Ω)."},
    {name:"–°–í–ò–ù–°–ö–ê –í–ï–®–ê–õ–ò–¶–ê", price:9.00, img:"snimki/produkti/2menu/sharska.jpg",
      desc:"–ö—Ä–µ—Ö–∫–æ —Å–≤–∏–Ω—Å–∫–æ –∫–æ–Ω—Ç—Ä–∞—Ñ–∏–ª–µ –Ω–∞ –∂–∞—Ä —Å—ä—Å —Å–≤–µ–∂–∏ –∑–µ–ª–µ–Ω—á—É—Ü–∏, —Ç—Ä–∏ –≤–∏–¥–∞ —Å–æ—Å–æ–≤–µ (–∫–µ—Ç—á—É–ø, –º–∞–π–æ–Ω–µ–∑–∞, –≥–æ—Ä—á–∏—Ü–∞), –ø—Ä–µ—Å–Ω–∏ –∫–∞—Ä—Ç–æ—Ñ–∫–∏ –∏ –ø—Ä—è—Å–Ω–∞ –ø–∏—Ç–∫–∞ (—Å–∞–º—É–Ω)."},
    {name:"–ü–ò–õ–ï–®–ö–ò –°–¢–ï–ö", price:9.00, img:"snimki/produkti/2menu/pileshkistek.jpg",
      desc:"–ü–∏–ª–µ—à–∫–æ —Ñ–∏–ª–µ –Ω–∞ –∂–∞—Ä —Å—ä—Å —Å–≤–µ–∂–∏ –∑–µ–ª–µ–Ω—á—É—Ü–∏, —Ç—Ä–∏ –≤–∏–¥–∞ —Å–æ—Å–æ–≤–µ (–∫–µ—Ç—á—É–ø, –º–∞–π–æ–Ω–µ–∑–∞, –≥–æ—Ä—á–∏—Ü–∞), –ø—Ä–µ—Å–Ω–∏ –∫–∞—Ä—Ç–æ—Ñ–∫–∏ –∏ –ø—Ä—è—Å–Ω–∞ –ø–∏—Ç–∫–∞ (—Å–∞–º—É–Ω)."},
    {name:"–í–ï–ì–ï–¢–ê–†–ò–ê–ù–°–ö–ò", price:5.00, img:"snimki/produkti/2menu/vegan.jpg",
      desc:"–°–≤–µ–∂–∏ –∑–µ–ª–µ–Ω—á—É—Ü–∏ , –ø—Ä–µ—Å–Ω–∏ –∫–∞—Ä—Ç–æ—Ñ–∫–∏ –∏ –ø—Ä—è—Å–Ω–∞ –ø–∏—Ç–∫–∞ (—Å–∞–º—É–Ω)."},
    {name:"–î–í–û–ô–ù–ê –®–ê–†–°–ö–ê –ü–õ–ï–°–ö–ê–í–ò–¶–ê", price:12.50, img:"snimki/produkti/2menu/sharska.jpg",
      desc:"–î–≤–æ–π–Ω–∞ —Ç–µ–ª–µ—à–∫–∞ –ø–ª–µ—Å–∫–∞–≤–∏—Ü–∞ —Å –∫–∞—à–∫–∞–≤–∞–ª –Ω–∞ –∂–∞—Ä —Å—ä—Å —Å–≤–µ–∂–∏ –∑–µ–ª–µ–Ω—á—É—Ü–∏, –ø—Ä–µ—Å–Ω–∏ –∫–∞—Ä—Ç–æ—Ñ–∫–∏ –∏ –ø—Ä—è—Å–Ω–∞ –ø–∏—Ç–∫–∞ (—Å–∞–º—É–Ω)."},
    {name:"–î–í–û–ô–ù–ê –ö–û–ù–°–ö–ê –ü–õ–ï–°–ö–ê–í–ò–¶–ê", price:12.00, img:"snimki/produkti/2menu/konski.jpg",
      desc:"–ú–ª—è–Ω–æ –∫–æ–Ω—Å–∫–æ –º–µ—Å–æ –Ω–∞ –∂–∞—Ä —Å—ä—Å —Å–≤–µ–∂–∏ –∑–µ–ª–µ–Ω—á—É—Ü–∏, –ø—Ä–µ—Å–Ω–∏ –∫–∞—Ä—Ç–æ—Ñ–∫–∏ –∏ –ø—Ä—è—Å–Ω–∞ –ø–∏—Ç–∫–∞ (—Å–∞–º—É–Ω)."},
    {name:"–î–í–û–ô–ù–ê –°–í–ò–ù–°–ö–ê –í–ï–®–ê–õ–ò–¶–ê", price:12.00, img:"snimki/produkti/2menu/sharska.jpg",
      desc:"–î–≤–æ–π–Ω–æ —Å–≤–∏–Ω—Å–∫–æ –∫–æ–Ω—Ç—Ä–∞—Ñ–∏–ª–µ –Ω–∞ –∂–∞—Ä —Å—ä—Å —Å–≤–µ–∂–∏ –∑–µ–ª–µ–Ω—á—É—Ü–∏, –ø—Ä–µ—Å–Ω–∏ –∫–∞—Ä—Ç–æ—Ñ–∫–∏ –∏ –ø—Ä—è—Å–Ω–∞ –ø–∏—Ç–∫–∞ (—Å–∞–º—É–Ω)."},
    {name:"–î–í–û–ï–ù –ü–ò–õ–ï–®–ö–ò –°–¢–ï–ö", price:12.00, img:"snimki/produkti/2menu/pileshkistek.jpg",
      desc:"–î–≤–æ–π–Ω–æ –ø–∏–ª–µ—à–∫–æ —Ñ–∏–ª–µ –Ω–∞ –∂–∞—Ä —Å—ä—Å —Å–≤–µ–∂–∏ –∑–µ–ª–µ–Ω—á—É—Ü–∏, –ø—Ä–µ—Å–Ω–∏ –∫–∞—Ä—Ç–æ—Ñ–∫–∏ –∏ –ø—Ä—è—Å–Ω–∞ –ø–∏—Ç–∫–∞ (—Å–∞–º—É–Ω)."},
    {name:"–î–í–û–ô–ù–ê –¢–ï–õ–ï–®–ö–ê –ü–õ–ï–°–ö–ê–í–ò–¶–ê", price:12.00, img:"snimki/produkti/2menu/sharska.jpg",
      desc:"–î–≤–æ–π–Ω–∞ —Ç–µ–ª–µ—à–∫–∞ –ø–ª–µ—Å–∫–∞–≤–∏—Ü–∞ –Ω–∞ –∂–∞—Ä —Å—ä—Å —Å–≤–µ–∂–∏ –∑–µ–ª–µ–Ω—á—É—Ü–∏, –ø—Ä–µ—Å–Ω–∏ –∫–∞—Ä—Ç–æ—Ñ–∫–∏ –∏ –ø—Ä—è—Å–Ω–∞ –ø–∏—Ç–∫–∞ (—Å–∞–º—É–Ω)."},
    {name:"–ë–£–†–ì–ï–† –° –î–™–†–ü–ê–ù–û –¢–ï–õ–ï–®–ö–û", price:12.50, img:"snimki/produkti/2menu/durpano.jpg",
      desc:"–î—ä—Ä–ø–∞–Ω–æ —Ç–µ–ª–µ—à–∫–æ –Ω–∞ –∂–∞—Ä —Å—ä—Å —Å–≤–µ–∂–∏ –∑–µ–ª–µ–Ω—á—É—Ü–∏, –ø—Ä–µ—Å–Ω–∏ –∫–∞—Ä—Ç–æ—Ñ–∫–∏ –∏ –ø—Ä—è—Å–Ω–∞ –ø–∏—Ç–∫–∞ (—Å–∞–º—É–Ω)."}
  ]},
  palachinki:{
    title:"–ü–ê–õ–ê–ß–ò–ù–ö–ò",
    groups:[
      { heading:"–°–õ–ê–î–ö–ò", items:[
        {name:"–ü–ê–õ–ê–ß–ò–ù–ö–ê –°–™–° NUCREMA –®–û–ö–û–õ–ê–î",price:5.00,img:"snimki/produkti/–ü–ê–õ–ê–ß–ò–ù–ö–ò/shokolad.jpg"},
        {name:"–ü–ê–õ–ê–ß–ò–ù–ö–ê –°–™–° NUCREMA –®–û–ö–û–õ–ê–î –ò –ë–ê–ù–ê–ù",price:6.00,img:"snimki/produkti/–ü–ê–õ–ê–ß–ò–ù–ö–ò/shokoladibanan.png"},
        {name:"–ü–ê–õ–ê–ß–ò–ù–ö–ê –° –ú–ï–î –ò –û–†–ï–•–ò",price:5.50,img:"snimki/produkti/–ü–ê–õ–ê–ß–ò–ù–ö–ò/mediorehi.png"},
        {name:"–ü–ê–õ–ê–ß–ò–ù–ö–ê –°–™–° –°–õ–ê–î–ö–û –û–¢ –ë–û–†–û–í–ò–ù–ö–ò",price:5.00,img:"snimki/produkti/–ü–ê–õ–ê–ß–ò–ù–ö–ò/borovinki.png"},
        {name:"–ü–ê–õ–ê–ß–ò–ù–ö–ê –°–™–° –°–õ–ê–î–ö–û –û–¢ –ü–†–ê–°–ö–û–í–ê",price:5.00,img:"snimki/produkti/–ü–ê–õ–ê–ß–ò–ù–ö–ò/praskovi.png"},
        {name:"–ü–ê–õ–ê–ß–ò–ù–ö–ê –°–™–° –°–õ–ê–î–ö–û –û–¢ –Ø–ì–û–î–ò",price:5.00,img:"snimki/produkti/–ü–ê–õ–ê–ß–ò–ù–ö–ò/qgodi.png"}
      ]},
      { heading:"–°–û–õ–ï–ù–ò", items:[
        {name:"–ü–ê–õ–ê–ß–ò–ù–ö–ê –° –ö–ê–®–ö–ê–í–ê–õ –ò –ë–ï–ö–û–ù",price:6.00,img:"snimki/produkti/–ü–ê–õ–ê–ß–ò–ù–ö–ò/kashkavalibekon.png"},
        {name:"–°–ò–†–ï–ù–ï –ò –°–õ–ê–î–ö–û",price:5.50,img:"snimki/produkti/–ü–ê–õ–ê–ß–ò–ù–ö–ò/sirene.png"},
        {name:"–ü–ê–õ–ê–ß–ò–ù–ö–ê –°–™–° –°–ò–†–ï–ù–ï",price:5.00,img:"snimki/produkti/–ü–ê–õ–ê–ß–ò–ù–ö–ò/sirene.png"},
        {name:"–ü–ê–õ–ê–ß–ò–ù–ö–ê –°–™–° –ö–ê–®–ö–ê–í–ê–õ",price:5.50,img:"snimki/produkti/–ü–ê–õ–ê–ß–ò–ù–ö–ò/kashkaval.png"},
        {name:"–ü–ê–õ–ê–ß–ò–ù–ö–ê –°–™–° –°–ò–†–ï–ù–ï –ò –ö–ê–®–ö–ê–í–ê–õ",price:6.00,img:"snimki/produkti/–ü–ê–õ–ê–ß–ò–ù–ö–ò/kashkavalisirene.png"},
        {name:"–ü–ê–õ–ê–ß–ò–ù–ö–ê –° –ú–ê–°–õ–û",price:4.50,img:"snimki/produkti/–ü–ê–õ–ê–ß–ò–ù–ö–ò/maslo.png"}
      ]}
    ]
  },
  strandzhanki:{ title:"–°–¢–†–ê–ù–î–ñ–ê–ù–ö–ò", items:[
    {name:"–¢–ï–õ–ï–®–ö–ê –°–¢–†–ê–ù–î–ñ–ê–ù–ö–ê",price:5.00,img:CAT_THUMBS.strandzhanki},
    {name:"–°–í–ò–ù–°–ö–ê –°–¢–†–ê–ù–î–ñ–ê–ù–ö–ê",price:5.00,img:CAT_THUMBS.strandzhanki}
  ]},
  kartofi:{ title:"–ö–ê–†–¢–û–§–ò", items:[
    {name:"–ü–™–†–ñ–ï–ù–ò –ö–ê–†–¢–û–§–ò 200 –ì–†–ê–ú–ê",price:4.00,img:"snimki/produkti/–ö–ê–†–¢–û–§–ò/kartofi.jpg"},
    {name:"–ö–ê–†–¢–û–§–ò –° –ß–ï–î–™–† –ò –ë–ï–ö–û–ù",price:6.50,img:"snimki/produkti/–ö–ê–†–¢–û–§–ò/kartofisbekonichedur.jpg"},
    {name:"–ö–ê–†–¢–û–§–ò –° –ß–ï–î–™–†",price:5.00,img:"snimki/produkti/–ö–ê–†–¢–û–§–ò/kartofischedur.jpg"}
  ]},
  salati:{
    title:"–°–ê–õ–ê–¢–ò",
    items:[
      {name:"–°–ê–õ–ê–¢–ê –¶–ï–ó–ê–†",price:8.50,img:CAT_THUMBS.salati,
       desc:"–ê–π—Å–±–µ—Ä–≥, —á–µ—Ä–∏ –¥–æ–º–∞—Ç–∏, –∫—Ä—É—Ç–æ–Ω–∏, —Å–æ—Å –¶–µ–∑–∞—Ä, –ø–∏–ª–µ—à–∫–æ —Ñ–∏–ª–µ, –ø–∞—Ä–º–µ–∑–∞–Ω"}
    ]
  },
  portsii:{ title:"–ü–û–†–¶–ò–ò", items:[
    {name:"–¢–ï–õ–ï–®–ö–ê –ü–õ–ï–°–ö–ê–í–ò–¶–ê –ü–û–†–¶–ò–Ø",price:11.50,img:"snimki/produkti/–ü–û–†–¶–ò–ò/sharsko.jpg",
      desc:"–ú–ª—è–Ω–æ —Ç–µ–ª–µ—à–∫–æ –º–µ—Å–æ –Ω–∞ —Å–∫–∞—Ä–∞, —Å—ä—Å —Å–≤–µ–∂–∏ –∑–µ–ª–µ–Ω—á—É—Ü–∏ –∏ –ø—Ä–µ—Å–Ω–∏ –∫–∞—Ä—Ç–æ—Ñ–∏. –ë–µ–∑ –ø–∏—Ç–∫–∞ –∏ –±–µ–∑ —Ä–∞–∑—è–¥–∫–∞. ~550 –≥."},
    {name:"–ö–û–ù–°–ö–ê –ü–õ–ï–°–ö–ê–í–ò–¶–ê –ü–û–†–¶–ò–Ø",price:11.50,img:"snimki/produkti/–ü–û–†–¶–ò–ò/sharsko.jpg",
      desc:"–ü—Ä—è—Å–Ω–æ –º–ª—è–Ω–æ –∫–æ–Ω—Å–∫–æ –Ω–∞ –∂–∞—Ä, —Å—ä—Å —Å–≤–µ–∂–∏ –∑–µ–ª–µ–Ω—á—É—Ü–∏ –∏ –∫–∞—Ä—Ç–æ—Ñ–∏. –ë–µ–∑ –ø–∏—Ç–∫–∞ –∏ –±–µ–∑ —Ä–∞–∑—è–¥–∫–∞. ~550 –≥."},
    {name:"–ü–ò–õ–ï–®–ö–û –§–ò–õ–ï –ü–û–†–¶–ò–Ø",price:11.00,img:"snimki/produkti/–ü–û–†–¶–ò–ò/pileshko.jpg",
      desc:"–ü—Ä—è—Å–Ω–æ –ø–∏–ª–µ—à–∫–æ —Ñ–∏–ª–µ –Ω–∞ –∂–∞—Ä —Å –≥–∞—Ä–Ω–∏—Ç—É—Ä–∞ –ø—Ä–µ—Å–Ω–∏ –∫–∞—Ä—Ç–æ—Ñ–∏ –∏ —Å–≤–µ–∂–∏ –∑–µ–ª–µ–Ω—á—É—Ü–∏. –ë–µ–∑ –ø–∏—Ç–∫–∞ –∏ –±–µ–∑ —Ä–∞–∑—è–¥–∫–∞. ~550 –≥."},
    {name:"–°–í–ò–ù–°–ö–û –§–ò–õ–ï –ü–û–†–¶–ò–Ø",price:11.00,img:"snimki/produkti/–ü–û–†–¶–ò–ò/svinsko.jpg",
      desc:"–ö—Ä–µ—Ö–∫–æ —Å–≤–∏–Ω—Å–∫–æ –∫–æ–Ω—Ç—Ä–∞ —Ñ–∏–ª–µ –Ω–∞ –∂–∞—Ä —Å –∫–∞—Ä—Ç–æ—Ñ–∏ –∏ —Å–≤–µ–∂–∞ –≥–∞—Ä–Ω–∏—Ç—É—Ä–∞. –ë–µ–∑ –ø–∏—Ç–∫–∞ –∏ –±–µ–∑ —Ä–∞–∑—è–¥–∫–∞. ~550 –≥."},
    {name:"–¢–ï–õ–ï–®–ö–ò –ö–ï–ë–ê–ü–ß–ï–¢–ê –ü–û–†–¶–ò–Ø",price:9.50,img:"snimki/produkti/–ü–û–†–¶–ò–ò/kebapche.jpg",
      desc:"–ê—Ä–æ–º–∞—Ç–Ω–∏ —Ç–µ–ª–µ—à–∫–∏ –∫–µ–±–∞–ø—á–µ—Ç–∞ –Ω–∞ –∂–∞—Ä —Å –ø—Ä–µ—Å–Ω–∏ –∫–∞—Ä—Ç–æ—Ñ–∏ –∏ —Å–∞–ª–∞—Ç–∞. –ë–µ–∑ –ø–∏—Ç–∫–∞ –∏ –±–µ–∑ —Ä–∞–∑—è–¥–∫–∞. ~550 –≥."},
    {name:"–®–ê–†–°–ö–ê –ü–õ–ï–°–ö–ê–í–ò–¶–ê –ü–û–†–¶–ò–Ø",price:12.50,img:"snimki/produkti/–ü–û–†–¶–ò–ò/sharsko.jpg",
      desc:"–¢–µ–ª–µ—à–∫–∞ –ø–ª–µ—Å–∫–∞–≤–∏—Ü–∞ —Å –∫–∞—à–∫–∞–≤–∞–ª, –≥–∞—Ä–Ω–∏—Ä–∞–Ω–∞ —Å –ø—Ä–µ—Å–Ω–∏ –∫–∞—Ä—Ç–æ—Ñ–∏ –∏ –∑–µ–ª–µ–Ω—á—É—Ü–∏. –ë–µ–∑ –ø–∏—Ç–∫–∞ –∏ –±–µ–∑ —Ä–∞–∑—è–¥–∫–∞. ~550 –≥."}
  ]},
  dobavki:{ title:"–î–û–ë–ê–í–ö–ò", items:[
    {name:"–°–ò–†–ï–ù–ï 100 –ì–†–ê–ú–ê",   price:1.50, img:"snimki/produkti/–î–û–ë–ê–í–ö–ò/sirene100grama.png"},
    {name:"–ö–ê–®–ö–ê–í–ê–õ 100 –ì–†–ê–ú–ê", price:1.50, img:"snimki/produkti/–î–û–ë–ê–í–ö–ò/kashkaval100grama.png"},
    {name:"–†–ê–ó–Ø–¢–ö–ê",            price:1.00, img:"snimki/produkti/–î–û–ë–ê–í–ö–ò/razqtka.png"},
    {name:"–ú–ï–°–û –î–û–ë–ê–í–ö–ê",       price:4.00, img:"snimki/produkti/–î–û–ë–ê–í–ö–ò/meso.jpg"},
    {name:"–ü–ò–¢–ö–ê",              price:1.50, img:"snimki/produkti/–î–û–ë–ê–í–ö–ò/pitka2.jpg"}
  ]},
  sosove:{ title:"–°–û–°–û–í–ï", items:[
    {name:"–î–û–ú–ê–®–ù–ê –†–ê–ó–Ø–î–ö–ê 100–ì–†", price:1.50, img:CAT_THUMBS.sosove},
    {name:"–î–û–ú–ê–®–ù–ê –ú–ê–ô–û–ù–ï–ó–ê",     price:1.50, img:CAT_THUMBS.sosove},
    {name:"–õ–Æ–¢–ï–ù–ò–¶–ê",             price:1.50, img:CAT_THUMBS.sosove},
    {name:"–ö–ï–¢–ß–£–ü",               price:1.00, img:CAT_THUMBS.sosove},
    {name:"–ì–û–†–ß–ò–¶–ê",              price:1.00, img:CAT_THUMBS.sosove},
    {name:"–°–û–° –¶–ï–ó–ê–†",            price:1.50, img:CAT_THUMBS.sosove}
  ]},
  deserti:{ title:"–î–ï–°–ï–†–¢–ò", items:[
    {name:"–õ–ï–ö –î–ï–°–ï–†–¢ –° –ß–ò–Ø, –ú–Æ–°–õ–ò –ò –°–£–®–ï–ù–ò –ü–õ–û–î–û–í–ï",price:4.50,img:CAT_THUMBS.deserti},
    {name:"–õ–ï–ö –î–ï–°–ï–†–¢ –° –ß–ò–Ø, –ú–Æ–°–õ–ò –ò –°–õ–ê–î–ö–û –û–¢ –ë–û–†–û–í–ò–ù–ö–ò",price:4.50,img:CAT_THUMBS.deserti}
  ]},
  bezalkoholni:{ title:"–ë–ï–ó–ê–õ–ö–û–•–û–õ–ù–ò", items:[
    {name:"–ö–û–õ–ê –ö–ï–ù",price:2.00,img:CAT_THUMBS.bezalkoholni},
    {name:"–§–ê–ù–¢–ê –ü–û–†–¢–û–ö–ê–õ –ö–ï–ù",price:2.00,img:CAT_THUMBS.bezalkoholni},
    {name:"–ö–û–ö–ê –ö–û–õ–ê –ë–£–¢–ò–õ–ö–ê",price:2.50,img:CAT_THUMBS.bezalkoholni},
    {name:"–§–ê–ù–¢–ê –ü–û–†–¢–û–ö–ê–õ –ë–£–¢–ò–õ–ö–ê",price:2.50,img:CAT_THUMBS.bezalkoholni},
    {name:"–°–ü–†–ê–ô–¢ –ë–£–¢–ò–õ–ö–ê",price:2.50,img:CAT_THUMBS.bezalkoholni},
    {name:"–°–¢–£–î–ï–ù –ß–ê–ô",price:2.50,img:CAT_THUMBS.bezalkoholni},
    {name:"–ö–ê–ü–ò –ü–™–õ–ü–ò",price:2.50,img:CAT_THUMBS.bezalkoholni},
    {name:"–ö–ê–ü–ò –ö–£–¢–ò–Ø",price:1.70,img:CAT_THUMBS.bezalkoholni},
    {name:"–°–û–î–ê –ë–£–¢–ò–õ–ö–ê",price:1.90,img:CAT_THUMBS.bezalkoholni},
    {name:"–ú–ê–õ–ö–ê –ú–ò–ù–ï–†–ê–õ–ù–ê –í–û–î–ê",price:1.50,img:CAT_THUMBS.bezalkoholni},
    {name:"–ì–û–õ–Ø–ú–ê –ú–ò–ù–ï–†–ê–õ–ù–ê –í–û–î–ê",price:2.00,img:CAT_THUMBS.bezalkoholni},
    {name:"–ö–ê–ü–ò –õ–ò–ú–û–ù–ê–î–ê",price:2.50,img:CAT_THUMBS.bezalkoholni},
    {name:"–¢–û–ù–ò–ö –ë–£–¢–ò–õ–ö–ê",price:1.90,img:CAT_THUMBS.bezalkoholni}
  ]},
  bira:{ title:"–ë–ò–†–ê", items:[
    {name:"–ë–ò–†–ê –ö–û–†–û–ù–ê",price:3.50,img:CAT_THUMBS.bira},
    {name:"–•–ê–ô–ù–ò–ö–ï–ù",price:4.00,img:CAT_THUMBS.bira},
    {name:"–°–¢–ï–õ–ê –ê–†–¢–û–ê",price:4.50,img:CAT_THUMBS.bira}
  ]},
  hell:{
    title:"HELL",
    view:"gallery",
    hellPrice:2.00,
    groups:[
      { heading:"HELL -250–º–ª", images:[
          "snimki/hell_sminki/normal/hell_apple.jpg",
          "snimki/hell_sminki/normal/hell_clasic.jpg",
          "snimki/hell_sminki/normal/hell_classic.jpg",
          "snimki/hell_sminki/normal/hell_redgrape.jpg",
          "snimki/hell_sminki/normal/hell_watermelon.jpg"
      ]},
      { heading:"ICE COFFE HELL -250 –º–ª", images:[
          "snimki/hell_sminki/ice_coffe/ice_coffe_capochino.png",
          "snimki/hell_sminki/ice_coffe/ice_coffe_caramel.png",
          "snimki/hell_sminki/ice_coffe/ice_coffe_coconut.png",
          "snimki/hell_sminki/ice_coffe/ice_coffe_doubleespresso.png",
          "snimki/hell_sminki/ice_coffe/ice_coffe_late.png",
          "snimki/hell_sminki/ice_coffe/ice_coffe_pinklatte.png",
          "snimki/hell_sminki/ice_coffe/ice_coffe_vanilia.png",
          "snimki/hell_sminki/ice_hell_distachio.png"
      ]}
    ]
  },
  voda:{
    title:"–í–û–î–ê",
    view:"water2",
    groups:[
      { heading:"Devin", pair:[
          {src:"snimki/produkti/–í–û–î–ê/golqma_devin.jpg", label:"–ì–æ–ª—è–º–∞ –î–µ–≤–∏–Ω -1,5–õ", price:2.00},
          {src:"snimki/produkti/–í–û–î–ê/malka_devin.jpg", label:"–ú–∞–ª–∫–∞ –î–µ–≤–∏–Ω -500–º–ª",  price:1.50}
      ]},
      { heading:"–ë–∞–Ω–∫—è", pair:[
          {src:"snimki/produkti/–í–û–î–ê/golqma_bankq.jpg", label:"–ì–æ–ª—è–º–∞ –ë–∞–Ω–∫—è -1,5–õ", price:2.00},
          {src:"snimki/produkti/–í–û–î–ê/malka_bankq.jpg", label:"–ú–∞–ª–∫–∞ –ë–∞–Ω–∫—è -500–º–ª",  price:1.50}
      ]}
    ]
  },
  gazirana_voda:{
    title:"–ì–ê–ó–ò–†–ê–ù–ê –í–û–î–ê",
    view:"water2",
    groups:[
      { heading:"–ú–∞—Ä–∫–∏", pair:[
          {src:"snimki/produkti/–ì–ê–ó–ò–†–ê–ù–ê_–í–û–î–ê/shveps.jpg",  label:"Schweppes -500–º–ª", price:1.90},
          {src:"snimki/produkti/–ì–ê–ó–ò–†–ê–ù–ê_–í–û–î–ê/sprait.jpg",  label:"Sprite -500–º–ª",    price:1.90}
      ]}
    ]
  },
  fanta:{
    title:"–§–ê–ù–¢–ê",
    items:[
      {name:"–§–∞–Ω—Ç–∞ –ü–æ—Ä—Ç–æ–∫–∞–ª -330–º–ª",      price:2.00, img:"snimki/produkti/–§–ê–ù–¢–ê/fanta_portokal.jpg"},
      {name:"–§–∞–Ω—Ç–∞ –õ–∏–º–æ–Ω -330–º–ª",         price:2.00, img:"snimki/produkti/–§–ê–ù–¢–ê/fanta_lemon.jpg"},
      {name:"–§–∞–Ω—Ç–∞ –õ–∞–π—á–∏ -330–º–ª",         price:2.00, img:"snimki/produkti/–§–ê–ù–¢–ê/fanta_laici.jpg"},
      {name:"–§–∞–Ω—Ç–∞ Tutti Frutti -330–º–ª",  price:2.00, img:"snimki/produkti/–§–ê–ù–¢–ê/fanta_tutti.jpg"},
      {name:"–§–∞–Ω—Ç–∞ –ó–µ–ª–µ–Ω–∞ —è–±—ä–ª–∫–∞ 330–º–ª", price:2.00, img:"snimki/produkti/–§–ê–ù–¢–ê/fanta_greenapple.jpg"},
      {name:"–§–∞–Ω—Ç–∞ –ë–æ—Ä–æ–≤–∏–Ω–∫–∞ -330–º–ª",     price:2.00, img:"snimki/produkti/–§–ê–ù–¢–ê/sinq_blueberry.jpg"}
    ]
  },
  studen_chai:{
    title:"–°–¢–£–î–ï–ù –ß–ê–ô",
    items:[
      { name:"Fuze Tea –ì–æ—Ä—Å–∫–∏ –ø–ª–æ–¥ -500–º–ª", price:2.50, img:"snimki/produkti/–°–¢–£–î–ï–ù_–ß–ê–ô/fuze_tea_forest_frut.jpg" },
      { name:"Fuze Tea –ü—Ä–∞—Å–∫–æ–≤–∞ -500–º–ª",    price:2.50, img:"snimki/produkti/–°–¢–£–î–ï–ù_–ß–ê–ô/fuze_tea_praskova.jpg" }
    ]
  },
  kola:{
    title:"–ö–û–õ–ê",
    items:[
      {name:"–ö–æ–ª–∞ –ö–µ–Ω -330–º–ª",        price:2.00, img:"snimki/produkti/–ö–û–õ–ê/kolaken.jpg"},
      {name:"–ö–æ–ª–∞ –ö–µ–Ω Zero -330–º–ª",   price:2.00, img:"snimki/produkti/–ö–û–õ–ê/kolakenzero.jpg"},
      {name:"–ö–æ–ª–∞ –ü–í–¶ -500–º–ª",        price:2.50, img:"snimki/produkti/–ö–û–õ–ê/kolapvc.jpg"},
      {name:"–ö–æ–ª–∞ –ü–í–¶ Zero -500–º–ª",   price:2.50, img:"snimki/produkti/–ö–û–õ–ê/kolapvczero.jpg"}
    ]
  },
  sok:{
    title:"–°–û–ö",
    items:[
      {name:"Cappy –ü–æ—Ä—Ç–æ–∫–∞–ª -500–º–ª", price:2.50, img:"snimki/produkti/–°–û–ö/cappy_orange.jpg"},
      {name:"Cappy –õ–∏–º–æ–Ω -500–º–ª",    price:2.50, img:"snimki/produkti/–°–û–ö/cappy_lemon.jpg"}
    ]
  },
  airqn:{
    title:"–ê–ô–†–Ø–ù",
    groups:[
      { heading:"–í–µ—Ä–µ—è", items:[
          {name:"–ê–π—Ä—è–Ω –í–µ—Ä–µ—è –ì–æ–ª—è–º -480–º–ª", price:2.00, img:"snimki/produkti/–ê–ô–†–ê–ù/airan_vereq_golqm.jpg"},
          {name:"–ê–π—Ä—è–Ω –í–µ—Ä–µ—è –ú–∞–ª—ä–∫ -300–º–ª", price:1.50, img:"snimki/produkti/–ê–ô–†–ê–ù/airan_vereq_maluk.jpg"}
      ]},
      { heading:"Meggle", items:[
          {name:"–ì–æ–ª—è–º –ê–π—Ä—è–Ω Meggle –ë—É—Ç–∏–ª–∫–∞ 500 –º–ª", price:2.80, img:"snimki/produkti/–ê–ô–†–ê–ù/megle_airan_butilka.jpg"},
          {name:"–ê–π—Ä—è–Ω Meggle –ö–æ—Ñ–∏—á–∫–∞ -300–º–ª",    price:2.00, img:"snimki/produkti/–ê–ô–†–ê–ù/megle_airan_kofa.jpg"},
          {name:"–ê–π—Ä—è–Ω Meggle –ü–ª–æ–¥–æ–≤ –ö–æ—Ñ–∏—á–∫–∞ -330–º–ª",  price:3.00, img:"snimki/produkti/–ê–ô–†–ê–ù/mwgle_airan_plodov.jpg"}
      ]}
    ]
  },
  xixo:{
    title:"XIXO",
    items:[
      {name:"XIXO Cola -250–º–ª",               price:1.10, img:"snimki/produkti/–•–ò–•–û/xixo_cola.jpg"},
      {name:"XIXO Cherry Cola -250–º–ª",        price:1.10, img:"snimki/produkti/–•–ò–•–û/xixo_cherry_cola.jpg"},
      {name:"XIXO –î–∏–Ω—è -250–º–ª",               price:1.10, img:"snimki/produkti/–•–ò–•–û/xixo_dinq.jpg"},
      {name:"XIXO –ì–æ—Ä—Å–∫–∏ –ø–ª–æ–¥ -250–º–ª",        price:1.10, img:"snimki/produkti/–•–ò–•–û/xixo_gorski_plod.jpg"},
      {name:"XIXO Green Fusion -250–º–ª",       price:1.10, img:"snimki/produkti/–•–ò–•–û/xixo_green_fusion.jpg"},
      {name:"XIXO –ö—Ä—É—à–∞ -250–º–ª",              price:1.10, img:"snimki/produkti/–•–ò–•–û/xixo_krusha.jpg"},
      {name:"XIXO –õ–∏–º–æ–Ω -250–º–ª",              price:1.10, img:"snimki/produkti/–•–ò–•–û/xixo_limon.jpg"},
      {name:"XIXO –ú–∞–Ω–≥–æ –∏ –∞–Ω–∞–Ω–∞—Å -250–º–ª",     price:1.10, img:"snimki/produkti/–•–ò–•–û/xixo_mango_and_pineapple.jpg"},
      {name:"XIXO –†–æ–∑–æ–≤–∞ –ª–∏–º–æ–Ω–∞–¥–∞ -250–º–ª",    price:1.10, img:"snimki/produkti/–•–ò–•–û/xixo_pink_lemonade.jpg"},
      {name:"XIXO –ü—Ä–∞—Å–∫–æ–≤–∞ -250–º–ª",           price:1.10, img:"snimki/produkti/–•–ò–•–û/xixo_praskova.jpg"},
      {name:"XIXO –Ø–≥–æ–¥–∞",                      price:1.10, img:"snimki/produkti/–•–ò–•–û/xixo_qgoda.jpg"},
      {name:"XIXO Tutti Frutti -250–º–ª",       price:1.10, img:"snimki/produkti/–•–ò–•–û/xixo_tuti_fruity.jpg"}
    ]
  }
};

/* === –ü–†–û–ú–û–¶–ò–ò (A + B) === */
const PROMOS = [
  {
    id: "promo1",
    a: { name: "–¢–ï–õ–ï–®–ö–ê –ü–õ–ï–°–ö–ê–í–ò–¶–ê", img: "snimki/produkti/2menu/sharska.jpg" },
    b: { name: "–ö–æ–ª–∞ –ö–µ–Ω", img: "snimki/produkti/–ö–û–õ–ê/kolaken.jpg" },
    price: 9.99,
    hero: "snimki/produkti/2menu/sharska.jpg"
  }
];

/* –ü–æ–¥—Ä–µ–¥–±–∞ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏—Ç–µ */
const ORDER = [
  "promocii",
  "burgeri","palachinki","strandzhanki","kartofi","salati","portsii","dobavki",
  "hell","voda","gazirana_voda","fanta","studen_chai","kola"
];

const sidebar = document.getElementById("sidebar");
const grid    = document.getElementById("productGrid");
const titleEl = document.getElementById("catTitle");

/* –î–µ–ª–µ–≥–∏—Ä–∞–Ω –∫–ª–∏–∫ –∑–∞ ‚Äû–í—Å–∏—á–∫–æ‚Äú (veg/sauce) */
grid.addEventListener("click", (e) => {
  const btn = e.target.closest(".btn-all");
  if (!btn) return;
  const group = btn.dataset.target;
  const host  = btn.closest(".addons");
  if (!group || !host) return;

  const boxes = [...host.querySelectorAll(`.addon-checkbox[data-group="${group}"]`)];
  if (!boxes.length) return;

  const allChecked = boxes.every(b => b.checked);
  boxes.forEach(b => b.checked = !allChecked);
});

/* –°–∞–π–¥–±–∞—Ä —Ä–µ–Ω–¥–µ—Ä */
sidebar.innerHTML = ORDER.map(key=>{
  const label = (key === "promocii") ? "–ü–†–û–ú–û–¶–ò–ò" : (CATALOG[key].title);
  const img   = CAT_THUMBS[key];
  return `<a class="cat" data-cat="${key}" role="link" tabindex="0" aria-label="${label}">
            <div class="box" style="background-image:url('${img}')" data-label="${label}"></div>
          </a>`;
}).join("");

/* pretty label –∑–∞ HELL */
function prettyLabel(src){
  let f = src.split("/").pop().split(".")[0].toLowerCase();
  f = f.replace(/^hell_/,"").replace(/^ice_coffe_/,"").replace(/^ice_hell_/,"");
  const map = {
    apple:"Apple", clasic:"Classic", classic:"Black Cherry",
    redgrape:"Red Grape", watermelon:"Watermelon",
    capochino:"Cappuccino", cappuccino:"Cappuccino", caramel:"Salted Caramel",
    coconut:"Coconut", doubleespresso:"Double Espresso", doublespresso:"Double Espresso",
    late:"Latte", latte:"Latte", pinklatte:"Pink Latte",
    vanilia:"Vanilla", vanilla:"Vanilla", distachio:"Pistachio", pistachio:"Pistachio",
    slimvanilla:"Vanilla"
  };
  if (map[f]) return map[f];
  return f.replace(/[_-]+/g," ").replace(/\b\w/g, m=>m.toUpperCase());
}

const catHasAddons = (cat) => (cat === "portsii" || cat === "burgeri" || cat === "strandzhanki");

/* === –†–ï–ù–î–ï–† –ù–ê –ü–†–û–î–£–ö–¢ === */
function productCardHTML(it, i, withAddons = false) {
  const desc = it.desc ? `<p class="desc">${esc(it.desc)}</p>` : "";

  const pricePlusRow = `
    <div class="price-plus">
      <div class="price-badge">
        <div class="lv">${fmtLv(it.price)}</div>
        <div class="eur">${fmtEur(it.price)}</div>
      </div>
      <button class="add-btn"
        data-name="${(it.name || "").replace(/"/g,"&quot;")}"
        data-price="${it.price}"
        data-img="${it.img}">+</button>
    </div>
  `;

  const mobileTitle = `<h3 class="mobile-title">${esc(it.name)}</h3>`;

  let leftColAfterPhoto = "";
  let actionsRowHTML = "";
  let wholeAddonsBlock = "";

  let mobileVeg = "";
  let mobileSauces = "";
  let mobileAddons = "";
  let mobileAddBtn = `
    <button class="mobile-add-btn add-btn"
      data-name="${(it.name || "").replace(/"/g,"&quot;")}"
      data-price="${it.price}"
      data-img="${it.img}">+</button>
  `;

  if (withAddons) {
    if (current === "burgeri") {
      const isPulled = /–î–™–†–ü–ê–ù–û/i.test(it.name || "");
      const vegList = isPulled
        ? [
            { c:"cheddar", t:"–¢–µ—á–µ–Ω —á–µ–¥—ä—Ä" },
            { c:"bbq",     t:"–ë–∞—Ä–±–µ–∫—é —Å–æ—Å" },
            { c:"car_on",  t:"–ö–∞—Ä–∞–º–µ–ª–∏–∑–∏—Ä–∞–Ω –ª—É–∫" },
            { c:"pickles", t:"–ö–∏—Å–µ–ª–∏ –∫—Ä–∞—Å—Ç–∞–≤–∏—á–∫–∏" },
            { c:"mayo_h",  t:"–î–æ–º–∞—à–Ω–∞ –º–∞–π–æ–Ω–µ–∑–∞" },
            { c:"fries",   t:"–ö–∞—Ä—Ç–æ—Ñ–∫–∏" }
          ]
        : [
            { c:"tomato",   t:"–î–æ–º–∞—Ç" },
            { c:"fries",    t:"–ü—Ä–µ—Å–Ω–∏ –∫–∞—Ä—Ç–æ—Ñ–∫–∏" },
            { c:"onion",    t:"–ß–µ—Ä–≤–µ–Ω –ª—É–∫" },
            { c:"iceberg",  t:"–ê–π—Å–±–µ—Ä–≥" },
            { c:"razyadka", t:"–†–∞–∑—è–¥–∫–∞" }
          ];
      const sauces = [
        { c:"ketchup", t:"–ö–µ—Ç—á—É–ø" },
        { c:"mayo",    t:"–ú–∞–π–æ–Ω–µ–∑–∞" },
        { c:"mustard", t:"–ì–æ—Ä—á–∏—Ü–∞" },
        { c:"chili",   t:"–õ—é—Ç–æ" }
      ];

      leftColAfterPhoto = `
        <div class="addons addons-underimg">
          <div class="hdr">
            –ò–∑–±–µ—Ä–µ—Ç–µ —Å –∫–∞–∫–≤–æ –¥–∞ –±—ä–¥–µ
            <button type="button" class="btn-all" data-target="veg">–í—Å–∏—á–∫–æ</button>
          </div>
          ${vegList.map(x => `
            <label>
              <input type="checkbox" class="addon-checkbox" data-group="veg" data-code="${x.c}" data-price="0"> ${x.t}
            </label>
          `).join("")}
        </div>`;
      actionsRowHTML = `
        <div class="actions-row">
          <div class="addons">
            <div class="hdr">
              –°–æ—Å–æ–≤–µ
              <button type="button" class="btn-all" data-target="sauce">–í—Å–∏—á–∫–æ</button>
            </div>
            ${sauces.map(x => `
              <label>
                <input type="checkbox" class="addon-checkbox" data-group="sauce" data-code="${x.c}" data-price="0"> ${x.t}
              </label>
            `).join("")}
          </div>
          <button class="add-btn"
            data-name="${(it.name || "").replace(/"/g,"&quot;")}"
            data-price="${it.price}"
            data-img="${it.img}">+</button>
        </div>`;

      mobileVeg = `
        <div class="mobile-veg">
          <div class="hdr">
            –ò–∑–±–µ—Ä–µ—Ç–µ —Å –∫–∞–∫–≤–æ –¥–∞ –±—ä–¥–µ
            <button type="button" class="btn-all" data-target="veg">–í—Å–∏—á–∫–æ</button>
          </div>
          ${vegList.map(x => `
            <label>
              <input type="checkbox" class="addon-checkbox" data-group="veg" data-code="${x.c}" data-price="0"> ${x.t}
            </label>
          `).join("")}
        </div>`;
      mobileSauces = `
        <div class="mobile-sauces">
          <div class="hdr">
            –°–æ—Å–æ–≤–µ
            <button type="button" class="btn-all" data-target="sauce">–í—Å–∏—á–∫–æ</button>
          </div>
          ${sauces.map(x => `
            <label>
              <input type="checkbox" class="addon-checkbox" data-group="sauce" data-code="${x.c}" data-price="0"> ${x.t}
            </label>
          `).join("")}
        </div>`;
    } else if (current === "portsii") {
      wholeAddonsBlock = `
        <div class="actions-row">
          <div class="addons">
            <div class="hdr">–î–æ–±–∞–≤–∫–∏</div>
            <label><input type="checkbox" class="addon-checkbox" data-code="pitka" data-price="1.5"> + –ü–∏—Ç–∫–∞</label>
            <label><input type="checkbox" class="addon-checkbox" data-code="raz" data-price="1.5"> + –†–∞–∑—è–¥–∫–∞ 100 –≥—Ä</label>
          </div>
          <button class="add-btn"
            data-name="${(it.name || "").replace(/"/g,"&quot;")}"
            data-price="${it.price}"
            data-img="${it.img}">+</button>
        </div>`;
      mobileAddons = `
        <div class="mobile-addons">
          <div class="hdr">–î–æ–±–∞–≤–∫–∏</div>
          <label><input type="checkbox" class="addon-checkbox" data-code="pitka" data-price="1.5"> + –ü–∏—Ç–∫–∞</label>
          <label><input type="checkbox" class="addon-checkbox" data-code="raz" data-price="1.5"> + –†–∞–∑—è–¥–∫–∞ 100 –≥—Ä</label>
        </div>`;
    } else if (current === "strandzhanki") {
      wholeAddonsBlock = `
        <div class="actions-row">
          <div class="addons">
            <div class="hdr">
              –°–æ—Å–æ–≤–µ
              <button type="button" class="btn-all" data-target="sauce">–í—Å–∏—á–∫–æ</button>
            </div>
            <label><input type="checkbox" class="addon-checkbox" data-group="sauce" data-code="ketchup" data-price="0"> –ö–µ—Ç—á—É–ø</label>
            <label><input type="checkbox" class="addon-checkbox" data-group="sauce" data-code="mayo"    data-price="0"> –ú–∞–π–æ–Ω–µ–∑–∞</label>
            <label><input type="checkbox" class="addon-checkbox" data-group="sauce" data-code="mustard" data-price="0"> –ì–æ—Ä—á–∏—Ü–∞</label>
            <label><input type="checkbox" class="addon-checkbox" data-group="sauce" data-code="chili"   data-price="0"> –õ—é—Ç–æ</label>
          </div>
          <button class="add-btn"
            data-name="${(it.name || "").replace(/"/g,"&quot;")}"
            data-price="${it.price}"
            data-img="${it.img}">+</button>
        </div>`;
      mobileSauces = `
        <div class="mobile-sauces">
          <div class="hdr">
            –°–æ—Å–æ–≤–µ
            <button type="button" class="btn-all" data-target="sauce">–í—Å–∏—á–∫–æ</button>
          </div>
          <label><input type="checkbox" class="addon-checkbox" data-group="sauce" data-code="ketchup" data-price="0"> –ö–µ—Ç—á—É–ø</label>
          <label><input type="checkbox" class="addon-checkbox" data-group="sauce" data-code="mayo"    data-price="0"> –ú–∞–π–æ–Ω–µ–∑–∞</label>
          <label><input type="checkbox" class="addon-checkbox" data-group="sauce" data-code="mustard" data-price="0"> –ì–æ—Ä—á–∏—Ü–∞</label>
          <label><input type="checkbox" class="addon-checkbox" data-group="sauce" data-code="chili"   data-price="0"> –õ—é—Ç–æ</label>
        </div>`;
    }
  }

  return `
    <article class="product ${i % 2 ? "even" : ""}">
      <div class="leftcol">
        <div class="photo" style="background-image:url('${it.img}')"></div>
        ${mobileTitle}
        ${leftColAfterPhoto}
      </div>

      <div class="pad">
        <h3 class="title">${esc(it.name)}</h3>
        ${desc}

        ${mobileVeg}
        ${mobileSauces}
        ${mobileAddons}

        ${pricePlusRow}

        ${ current === "burgeri" ? actionsRowHTML : (wholeAddonsBlock || "") }

        ${mobileAddBtn}
      </div>
    </article>`;
}

/* --- –£–≤–µ–ª–∏—á–∞–≤–∞–Ω–µ –ø—Ä–∏ –¥–≤–æ–µ–Ω –∫–ª–∏–∫ (desktop) --- */
document.addEventListener("dblclick", e => {
  const imgEl = e.target.closest(".photo");
  if (!imgEl) return;

  const alreadyZoomed = imgEl.classList.contains("zoomed");
  document.querySelectorAll(".photo.zoomed").forEach(el => el.classList.remove("zoomed"));

  if (alreadyZoomed) {
    document.body.style.overflow = "";
  } else {
    imgEl.classList.add("zoomed");
    document.body.style.overflow = "hidden";
  }
});

/* --- Double-tap –∑–∞ –º–æ–±–∏–ª–Ω–∏ --- */
document.addEventListener("touchend", (e) => {
  const imgEl = e.target.closest(".photo");
  if (!imgEl) return;

  const now = Date.now();
  const last = imgEl._lastTap || 0;

  if (now - last < 280) {
    const already = imgEl.classList.contains("zoomed");
    document.querySelectorAll(".photo.zoomed").forEach(el => el.classList.remove("zoomed"));
    if (!already) {
      imgEl.classList.add("zoomed");
      document.body.style.overflow = "hidden";
    } else {
      document.body.style.overflow = "";
    }
    imgEl._lastTap = 0;
  } else {
    imgEl._lastTap = now;
  }
}, { passive: true });

/* –ø–æ–º–æ—â–Ω–∏–∫ –∑–∞ –∏–∑—Ä–µ—á–µ–Ω–∏—è—Ç–∞ –ø—Ä–∏ –±–µ–ª–µ–∂–∫–∞—Ç–∞ */
function groupPhrase(card, group, kind){
  if (!card) return "";
  const all = [...card.querySelectorAll(`.addon-checkbox[data-group="${group}"]`)];
  if (!all.length) return "";

  const labelOf = (b) => (b.closest("label")?.textContent || "")
                          .trim()
                          .replace(/^\+\s*/, "");

  const allNames = all.map(labelOf);
  const sel      = all.filter(b => b.checked);
  const selNames = sel.map(labelOf);

  if (sel.length === all.length && sel.length > 0) {
    return kind === "veg" ? "—Å –≤—Å–∏—á–∫–æ" : "–≤—Å–∏—á–∫–∏ —Å–æ—Å–æ–≤–µ";
  }
  if (sel.length > 0) {
    const missing = allNames.filter(n => !selNames.includes(n));
    const base = kind === "veg" ? "–≤—Å–∏—á–∫–æ –±–µ–∑ ‚Äî " : "–≤—Å–∏—á–∫–∏ —Å–æ—Å–æ–≤–µ –±–µ–∑ ‚Äî ";
    return base + (missing.length ? missing.join(", ") : "(–Ω–∏—â–æ)");
  }
  return "";
}

/* –î–æ–±–∞–≤—è–Ω–µ ‚Äì —Å–ª—É—à–∞—Ç–µ–ª–∏ –∑–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—Ç–µ –ø—Ä–æ–¥—É–∫—Ç–∏ */
function bindAddButtons(){
  grid.querySelectorAll(".add-btn").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const card = btn.closest(".product");
      const baseName  = btn.getAttribute("data-name");
      const basePrice = Number(btn.getAttribute("data-price")) || 0;
      const img       = btn.getAttribute("data-img") || "";

      const checks = card ? [...card.querySelectorAll(".addon-checkbox:checked")] : [];
      const addons = checks.map(ch => {
        const code  = ch.getAttribute("data-code");
        const def   = ADDONS[code] || {};
        const price = Number(ch.getAttribute("data-price")) || def.price || 0;
        const labelFromDOM = (ch.closest("label")?.textContent || "").trim();
        const labelClean = (labelFromDOM || def.label || "–î–æ–±–∞–≤–∫–∞").replace(/^\+\s*/, "");
        return { code, label: labelClean, price };
      });

      const addonsTotal = addons.reduce((s,a)=>s+a.price,0);
      const fullPrice   = basePrice + addonsTotal;

      const nameWithAddons = addons.length
        ? `${baseName} (+ ${addons.map(a=>a.label).join(", ")})`
        : baseName;

      addToCart({
        _id: Date.now()+""+Math.random(),
        name: nameWithAddons,
        baseName,
        price: fullPrice,
        basePrice,
        addons,
        img
      });

      const vegLine   = card ? groupPhrase(card, "veg",   "veg")   : "";
      const sauceLine = card ? groupPhrase(card, "sauce", "sauce") : "";
      const parts = [vegLine, sauceLine].filter(Boolean);
      if (parts.length) {
        const line = `${baseName}: ${parts.join("; ")}`;
        const cur  = (orderNoteEl.value || "").trim();
        orderNoteEl.value = cur ? (cur + "\n" + line) : line;
        localStorage.setItem(LS_ORDER_NOTE, orderNoteEl.value);
      }

      btn.textContent = "‚úì";
      setTimeout(()=> btn.textContent = "+", 450);

      checks.forEach(ch => ch.checked = false);
    });
  });
}

/* === –ü–†–û–ú–û: ‚Äû+‚Äú ‚Üí –¥–æ–±–∞–≤—è–Ω–µ –≤ –∫–æ–ª–∏—á–∫–∞—Ç–∞ –∫–∞—Ç–æ –µ–¥–∏–Ω –∞—Ä—Ç–∏–∫—É–ª (—Ü–µ–Ω—Ç—Ä–∞–ª–µ–Ω –±—É—Ç–æ–Ω) === */
function bindPromoButtons(){
  grid.querySelectorAll(".promo-card .promo-add").forEach(btn => {
    btn.addEventListener("click", () => {
      const card = btn.closest(".promo-card");
      const id = card?.getAttribute("data-promo-id");
      const p = PROMOS.find(x => x.id === id);
      if (!p) return;

      const displayName = `–ü–†–û–ú–û: ${p.a.name} + ${p.b.name}`;
      const img = p.hero || p.a.img || p.b.img || "";
      const price = Number(p.price) || 0;

      addToCart({
        _id: Date.now() + "" + Math.random(),
        name: displayName,
        baseName: displayName,
        price: price,
        basePrice: price,
        img,
        addons: [{ code: "promo", label: "–ü—Ä–æ–º–æ –ø–∞–∫–µ—Ç", price: 0 }]
      });

      // –∑–∞–ø–∏—Å –≤ –±–µ–ª–µ–∂–∫–∞—Ç–∞ (–ø–æ-—è—Å–Ω–æ –∑–∞ –∫—É—Ö–Ω—è—Ç–∞)
      const line = `${displayName} (${fmtLv(price)} / ${fmtEur(price)})`;
      const cur  = (orderNoteEl.value || "").trim();
      orderNoteEl.value = cur ? (cur + "\n" + line) : line;
      localStorage.setItem(LS_ORDER_NOTE, orderNoteEl.value);

      // –º–∞–ª–∫–∞ –≤–∏–∑—É–∞–ª–Ω–∞ –æ–±—Ä–∞—Ç–Ω–∞ –≤—Ä—ä–∑–∫–∞
      const was = btn.textContent;
      btn.textContent = "‚úì";
      setTimeout(() => (btn.textContent = was), 450);
    });
  });
}

/* ===== –ê–∫—Ç–∏–≤–∏—Ä–∞–Ω–µ –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è + —Ä–µ–Ω–¥–µ—Ä ===== */
let current = null;

function activate(cat, {fromNav=false, replace=false} = {}){

  /* üß° –ü–†–û–ú–û–¶–ò–ò ‚Äî —Å—Ç–∞—Ç–∏—á–µ–Ω –∏–∑–≥–ª–µ–¥ –∫–∞—Ç–æ –°–Ω–∏–º–∫–∞ 1 (—Ü–µ–Ω—Ç—Ä–∞–ª–µ–Ω ‚Äû+‚Äú) */
  if (cat === "promocii") {
    current = "promocii";
    sidebar.querySelectorAll(".cat")
      .forEach(c => c.classList.toggle("active", c.dataset.cat === "promocii"));

    const url = new URL(location.href);
    if (url.searchParams.get("cat") !== "promocii") {
      url.searchParams.set("cat", "promocii");
      if (replace) history.replaceState({ cat: "promocii" }, "", url);
      else if (fromNav) history.pushState({ cat: "promocii" }, "", url);
    }

    titleEl.textContent = "–ü–†–û–ú–û–¶–ò–ò";

    grid.innerHTML = `
      <section class="promo-wrap">
        <h2 class="promo-head">üî• Corner BBQ ‚Äî –ü—Ä–æ–º–æ—Ü–∏–∏</h2>
        <div class="promo-grid">
          ${PROMOS.map(p => `
            <article class="promo-card" data-promo-id="${p.id}">
              <div class="promo-sides">
                <div class="promo-img" style="background-image:url('${p.a.img}')"></div>
                <div class="promo-img" style="background-image:url('${p.b.img}')"></div>
              </div>
              <div class="promo-price">${fmtLv(p.price)}</div>
              <!-- –¶–µ–Ω—Ç—Ä–∞–ª–Ω–∏—è—Ç –∫—Ä—ä–≥—ä–ª ‚Äû+‚Äú -->
              <button class="promo-add" type="button" aria-label="–î–æ–±–∞–≤–∏ –ø—Ä–æ–º–æ">+</button>
            </article>
          `).join("")}
        </div>
      </section>
    `;

    bindPromoButtons();
    recalcMobileOffsets();
    ensurePlusRightUniversal?.();
    return;
  }

  const exists = !!CATALOG[cat];
  if(!exists) cat = "burgeri";
  current = cat;

  sidebar.querySelectorAll(".cat").forEach(c=>c.classList.toggle("active", c.dataset.cat===cat));
  titleEl.textContent = CATALOG[cat]?.title || cat.toUpperCase();

  const url2 = new URL(location.href);
  if (url2.searchParams.get("cat") !== cat) {
    url2.searchParams.set("cat", cat);
    if (replace) history.replaceState({cat}, "", url2);
    else if (fromNav) history.pushState({cat}, "", url2);
  }

  const data = CATALOG[cat];

  if (data.view === "water2") {
    grid.innerHTML = `
      <div class="water-wrapper">
        ${data.groups.map(g=>`
          <section class="water-block">
            <h2>${g.heading}</h2>
            <div class="water-grid">
              ${g.pair.map(p=>`
                <div class="water-card">
                  <img src="${p.src}" alt="${p.label}">
                  <div class="water-name">${p.label}</div>
                  ${typeof p.price === "number" ? `
                    <div class="price-badge">
                      <div class="lv">${fmtLv(p.price)}</div>
                      <div class="eur">${fmtEur(p.price)}</div>
                    </div>
                    <button class="add-btn" data-name="${p.label.replace(/"/g,"&quot;")}" data-price="${p.price}" data-img="${p.src}">+</button>
                  ` : ``}
                </div>
              `).join("")}
            </div>
          </section>
        `).join("")}
      </div>
    `;
    return;
  }

  if (data.view === "gallery") {
    const hellPrice = data.hellPrice ?? 2.00;
    grid.innerHTML = data.groups.map(group=>{
      const pics = group.images.map(src=>{
        const label = prettyLabel(src);
        return `
        <div>
          <div class="tile">
            <img src="${src}" alt="${label}">
            <div class="price-badge">
              <div class="lv">${fmtLv(hellPrice)}</div>
              <div class="eur">${fmtEur(hellPrice)}</div>
            </div>
            <button class="add-btn" data-name="${label.replace(/"/g,"&quot;")}" data-price="${hellPrice}" data-img="${src}">+</button>
          </div>
          <div class="caption">${label}</div>
        </div>`;
      }).join("");
      return `
        <h2 class="sec-title">${group.heading}</h2>
        <div class="gallery">${pics}</div>
      `;
    }).join("");
    bindAddButtons();
    recalcMobileOffsets();
    ensureMobilePlusRight();
    return;
  }

  if (data.groups && Array.isArray(data.groups)) {
    const groupsHTML = data.groups.map(group => `
      <h2 class="sec-title">${group.heading}</h2>
      <div class="grid-products">
       ${group.items?.map((it,i)=> productCardHTML(it,i, catHasAddons(current))).join("")}
      </div>
    `).join("");
    grid.innerHTML = groupsHTML;
    bindAddButtons();
    recalcMobileOffsets();
    ensureMobilePlusRight();
    return;
  }

  const items = (data?.items)||[];
  if (items.length === 0) {
    grid.innerHTML = `<p style="padding:16px;font-weight:700">–ù—è–º–∞ –ø—Ä–æ–¥—É–∫—Ç–∏ –≤ —Ç–∞–∑–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è.</p>`;
    recalcMobileOffsets();
    return;
  }
  grid.innerHTML = `
    <div class="grid-products">
      ${items.map((it,i)=> productCardHTML(it,i, catHasAddons(current))).join("")}
    </div>
  `;
  bindAddButtons();
  recalcMobileOffsets();
  ensureMobilePlusRight();
}

/* POP DELAY –≤ —Å–∞–π–¥–±–∞—Ä–∞ */
const POP_DELAY = 100; // ms
function shouldBypassDelay(evt){ return evt.metaKey || evt.ctrlKey || evt.shiftKey || evt.altKey || evt.button === 1; }
function popThenActivate(el, key){
  el.classList.remove("is-pressed"); el.classList.add("is-popping"); el.dataset.locked = "1";
  setTimeout(()=>{ activate(key, {fromNav:true}); el.classList.remove("is-popping"); delete el.dataset.locked; }, POP_DELAY);
}

/* –ß–µ—Ç–∏ cat –æ—Ç URL –ø—Ä–∏ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ */
function initFromURL(){
  const params = new URLSearchParams(location.search);
  const cat = params.get("cat") || "burgeri";
  activate(cat, {replace:true});
}

/* –í—ä–∑—Å—Ç–∞–Ω–æ–≤–∏ –∫–æ–ª–∏—á–∫–∞—Ç–∞ –ø—Ä–∏ –ø—ä—Ä–≤–æ –∑–∞—Ä–µ–∂–¥–∞–Ω–µ */
restoreCartFromLS();
restoreOrderNote();
initFromURL();

/* –°—ä–±–∏—Ç–∏—è –∑–∞ —Å–∞–π–¥–±–∞—Ä –∫–∞—Ä—Ç–∏—Ç–µ */
sidebar.querySelectorAll(".cat").forEach(catEl=>{
  const key = catEl.dataset.cat;
  catEl.addEventListener("touchstart", ()=>{
    catEl.classList.add("is-pressed");
    setTimeout(()=>catEl.classList.remove("is-pressed"), 120);
  }, {passive:true});
  catEl.addEventListener("mousedown", ()=>catEl.classList.add("is-pressed"));
  catEl.addEventListener("mouseleave", ()=>catEl.classList.remove("is-pressed"));
  catEl.addEventListener("mouseup",   ()=>catEl.classList.remove("is-pressed"));
  catEl.addEventListener("click", (e)=>{
    if (shouldBypassDelay(e)) return;
    e.preventDefault();
    if (catEl.dataset.locked==="1" || key===current) return;
    popThenActivate(catEl, key);
  });
  catEl.addEventListener("keydown", (e)=>{
    if (e.key==="Enter" || e.key===" "){
      e.preventDefault();
      if (catEl.dataset.locked==="1" || key===current) return;
      popThenActivate(catEl, key);
    }
  });
});

/* Back/Forward */
addEventListener("popstate", (e)=>{
  const cat = (e.state && e.state.cat) || new URLSearchParams(location.search).get("cat") || "burgeri";
  activate(cat, {replace:true});
});

/* –ü–æ—á–∏—Å—Ç–≤–∞–Ω–µ –Ω–∞ –∫–ª–∞—Å–æ–≤–µ –ø—Ä–∏ pageshow */
addEventListener("pageshow", ()=>{
  sidebar.querySelectorAll(".cat").forEach(c=>{ c.classList.remove("is-pressed","is-popping"); delete c.dataset.locked; });
});

/* –ü–ª–∞–≤–∞—â–æ –¥–≤–∏–∂–µ–Ω–∏–µ –Ω–∞ –±—É—Ç–æ–Ω–∞ ‚Äû–ù–∞—á–∞–ª–æ‚Äú */
(function(){
  const home = document.querySelector(".home-pill");
  const content = document.querySelector(".content");
  if(!home || !content) return;

  const TOP = 16, BOTTOM_MARGIN = 16, SPEED = 0.25;
  let cur = 0, target = 0, rafId = 0;

  function maxShift(){ return Math.max(0, window.innerHeight - TOP - BOTTOM_MARGIN - home.offsetHeight); }
  function updateLeft(){
    const rect = content.getBoundingClientRect();
    home.style.left = (rect.left + 20) + "px";
  }
  function onScroll(){
    const doc = document.documentElement;
    const scrollMax = Math.max(1, doc.scrollHeight - window.innerHeight);
    const progress = window.scrollY / scrollMax;
    target = progress * maxShift();
    if(!rafId) rafId = requestAnimationFrame(tick);
  }
  function tick(){
    rafId = 0;
    cur += (target - cur) * SPEED;
    home.style.transform = `translateY(${cur.toFixed(2)}px)`;
    if (Math.abs(target - cur) > 0.5) rafId = requestAnimationFrame(tick);
  }
  addEventListener("scroll", onScroll, {passive:true});
  addEventListener("resize", ()=>{ updateLeft(); onScroll(); });
  updateLeft(); onScroll();
})();

/* HOME —Å–ø–æ—Ä–µ–¥ —Å—Ä–µ–¥–∞—Ç–∞ */
(function(){
  const home = document.querySelector(".home-pill");
  if (!home) return;
  const HOME_LOCAL = "file:///E:/BBQ_SITE/index.html";
  const HOME_WEB   = "index.html";
  home.addEventListener("click", function(e){
    if (e.ctrlKey || e.metaKey || e.shiftKey || e.altKey || e.button === 1) return;
    e.preventDefault();
    const target = (location.protocol === "file:") ? HOME_LOCAL : HOME_WEB;
    window.location.href = target;
  });
})();

/* ===== –î–ò–ù–ê–ú–ò–ß–ù–ò –û–§–°–ï–¢–ò (–º–æ–±–∏–ª–µ–Ω) ===== */
function recalcMobileOffsets(){
  const isMobile = window.matchMedia("(max-width: 900px)").matches;
  if(!isMobile) return;

  const cart = document.getElementById("cartBtn");
  const sb   = document.querySelector(".sidebar");

  const cartH = cart ? Math.ceil(cart.offsetHeight) + 12 : 54;
  const sbH   = sb   ? Math.ceil(sb.getBoundingClientRect().height) : 100;

  document.documentElement.style.setProperty("--mobile-cart-h", cartH + "px");
  document.documentElement.style.setProperty("--mobile-sidebar-h", sbH + "px");
}
addEventListener("load", recalcMobileOffsets, { once:true });
addEventListener("resize", recalcMobileOffsets);
addEventListener("orientationchange", recalcMobileOffsets);

const sidebarNode = document.getElementById("sidebar");
if (sidebarNode) {
  const sbObserver = new MutationObserver(recalcMobileOffsets);
  sbObserver.observe(sidebarNode, { childList:true, subtree:true });
}

/* –°–∫—Ä–∏–≤–∞–Ω–µ/–ø–æ–∫–∞–∑–≤–∞–Ω–µ –Ω–∞ —Å–∞–π–¥–±–∞—Ä–∞ –ø—Ä–∏ —Å–∫—Ä–æ–ª */
let lastScrollY = window.scrollY;
let ticking = false;

function handleScrollHideSidebar() {
  const sidebarEl = document.querySelector(".sidebar");
  if (!sidebarEl) { ticking = false; return; }

  const currentY = window.scrollY;
  if (currentY > lastScrollY + 10) {
    sidebarEl.classList.add("hide-on-scroll");
  } else if (currentY < lastScrollY - 10) {
    sidebarEl.classList.remove("hide-on-scroll");
  }
  lastScrollY = currentY;
  ticking = false;
}

addEventListener("scroll", () => {
  if (!ticking) {
    ticking = true;
    requestAnimationFrame(handleScrollHideSidebar);
  }
}, { passive:true });

/* === FULLSCREEN ZOOM: –¥–≤–æ–π–Ω–æ –¥–æ–∫–æ—Å–≤–∞–Ω–µ/–∫–ª–∏–∫ === */
(function(){
  const lb     = document.getElementById('bbqLightbox');
  const lbImg  = document.getElementById('bbqLightImg');
  const lbClose= lb ? lb.querySelector('.close') : null;
  if (!lb || !lbImg || !lbClose) return;

  function extractBgUrl(el){
    const bg = getComputedStyle(el).backgroundImage || '';
    const m = bg.match(/url\(["']?(.*?)["']?\)/i);
    return m ? m[1] : '';
  }
  function openLightboxFrom(el){
    const src = el.tagName === 'IMG' ? el.src : extractBgUrl(el);
    if(!src) return;
    lbImg.src = src;
    lb.classList.add('show');
    document.body.style.overflow = 'hidden';
  }
  function closeLightbox(){
    lb.classList.remove('show');
    document.body.style.overflow = '';
  }

  lbClose.addEventListener('click', closeLightbox);
  lb.addEventListener('click', e => { if(e.target===lb) closeLightbox(); });
  document.addEventListener('keydown', e => { if(e.key==='Escape') closeLightbox(); });

  // Desktop: –¥–≤–æ–π–Ω–æ –∫–ª–∏–∫–≤–∞–Ω–µ
  document.addEventListener('dblclick', e => {
    const photo = e.target.closest('.photo, .water-card img, .tile img');
    if (!photo) return;
    openLightboxFrom(photo);
  });

  // Mobile: –¥–≤–æ–π–Ω–æ –¥–æ–∫–æ—Å–≤–∞–Ω–µ
  let lastTap = 0, tapTarget = null;
  document.addEventListener('touchend', e => {
    const photo = e.target.closest('.photo, .water-card img, .tile img');
    if (!photo) return;
    const now = Date.now();
    if (tapTarget === photo && (now - lastTap) < 300) {
      openLightboxFrom(photo);
      tapTarget = null; lastTap = 0;
    } else {
      tapTarget = photo; lastTap = now;
    }
  }, { passive:true });
})();
